<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WekaPackageManager.java</title>
    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700" rel="stylesheet">
</head>
<body>

<div class="container">
    <div id="code_area" class="container_0">
<div>1&emsp;&emsp;/*</div>
<div>2&emsp;&emsp;&nbsp; *   This program is free software: you can redistribute it and/or modify</div>
<div>3&emsp;&emsp;&nbsp; *   it under the terms of the GNU General Public License as published by</div>
<div>4&emsp;&emsp;&nbsp; *   the Free Software Foundation, either version 3 of the License, or</div>
<div>5&emsp;&emsp;&nbsp; *   (at your option) any later version.</div>
<div>6&emsp;&emsp;&nbsp; *</div>
<div>7&emsp;&emsp;&nbsp; *   This program is distributed in the hope that it will be useful,</div>
<div>8&emsp;&emsp;&nbsp; *   but WITHOUT ANY WARRANTY; without even the implied warranty of</div>
<div>9&emsp;&emsp;&nbsp; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</div>
<div>10&emsp;&emsp;&nbsp; *   GNU General Public License for more details.</div>
<div>11&emsp;&emsp;&nbsp; *</div>
<div>12&emsp;&emsp;&nbsp; *   You should have received a copy of the GNU General Public License</div>
<div>13&emsp;&emsp;&nbsp; *   along with this program.  If not, see &#60;http://www.gnu.org/licenses/>.</div>
<div>14&emsp;&emsp;&nbsp; */</div>
<div>15&emsp;&emsp;</div>
<div>16&emsp;&emsp;/*</div>
<div>17&emsp;&emsp;&nbsp; *    WekaPackageManager.java</div>
<div>18&emsp;&emsp;&nbsp; *    Copyright (C) 2009-2013 University of Waikato, Hamilton, New Zealand</div>
<div>19&emsp;&emsp;&nbsp; */</div>
<div>20&emsp;&emsp;</div>
<div>21&emsp;&emsp;package weka.core;</div>
<div>22&emsp;&emsp;</div>
<div>23&emsp;&emsp;import weka.core.converters.ConverterUtils;</div>
<div>24&emsp;&emsp;import weka.core.logging.Logger;</div>
<div>25&emsp;&emsp;import weka.core.packageManagement.DefaultPackageManager;</div>
<div>26&emsp;&emsp;import weka.core.packageManagement.Dependency;</div>
<div>27&emsp;&emsp;import weka.core.packageManagement.Package;</div>
<div>28&emsp;&emsp;import weka.core.packageManagement.PackageConstraint;</div>
<div>29&emsp;&emsp;import weka.core.packageManagement.PackageManager;</div>
<div>30&emsp;&emsp;import weka.core.packageManagement.VersionPackageConstraint;</div>
<div>31&emsp;&emsp;import weka.gui.GenericObjectEditor;</div>
<div>32&emsp;&emsp;import weka.gui.GenericPropertiesCreator;</div>
<div>33&emsp;&emsp;import weka.gui.beans.BeansProperties;</div>
<div>34&emsp;&emsp;import weka.gui.beans.KnowledgeFlowApp;</div>
<div>35&emsp;&emsp;import weka.gui.explorer.ExplorerDefaults;</div>
<div>36&emsp;&emsp;</div>
<div>37&emsp;&emsp;import java.io.BufferedInputStream;</div>
<div>38&emsp;&emsp;import java.io.BufferedOutputStream;</div>
<div>39&emsp;&emsp;import java.io.BufferedReader;</div>
<div>40&emsp;&emsp;import java.io.BufferedWriter;</div>
<div>41&emsp;&emsp;import java.io.ByteArrayInputStream;</div>
<div>42&emsp;&emsp;import java.io.File;</div>
<div>43&emsp;&emsp;import java.io.FileInputStream;</div>
<div>44&emsp;&emsp;import java.io.FileNotFoundException;</div>
<div>45&emsp;&emsp;import java.io.FileOutputStream;</div>
<div>46&emsp;&emsp;import java.io.FileWriter;</div>
<div>47&emsp;&emsp;import java.io.IOException;</div>
<div>48&emsp;&emsp;import java.io.InputStreamReader;</div>
<div>49&emsp;&emsp;import java.io.ObjectInputStream;</div>
<div>50&emsp;&emsp;import java.io.ObjectOutputStream;</div>
<div>51&emsp;&emsp;import java.io.PrintStream;</div>
<div>52&emsp;&emsp;import java.net.MalformedURLException;</div>
<div>53&emsp;&emsp;import java.net.URI;</div>
<div>54&emsp;&emsp;import java.net.URL;</div>
<div>55&emsp;&emsp;import java.net.URLConnection;</div>
<div>56&emsp;&emsp;import java.text.SimpleDateFormat;</div>
<div>57&emsp;&emsp;import java.util.ArrayList;</div>
<div>58&emsp;&emsp;import java.util.Date;</div>
<div>59&emsp;&emsp;import java.util.Enumeration;</div>
<div>60&emsp;&emsp;import java.util.HashMap;</div>
<div>61&emsp;&emsp;import java.util.HashSet;</div>
<div>62&emsp;&emsp;import java.util.Iterator;</div>
<div>63&emsp;&emsp;import java.util.List;</div>
<div>64&emsp;&emsp;import java.util.Map;</div>
<div>65&emsp;&emsp;import java.util.Properties;</div>
<div>66&emsp;&emsp;import java.util.Set;</div>
<div>67&emsp;&emsp;import java.util.StringTokenizer;</div>
<div>68&emsp;&emsp;import java.util.zip.ZipEntry;</div>
<div>69&emsp;&emsp;import java.util.zip.ZipInputStream;</div>
<div>70&emsp;&emsp;</div>
<div>71&emsp;&emsp;/**</div>
<div>72&emsp;&emsp;&nbsp; * Class providing package management and manipulation routines. Also provides a</div>
<div>73&emsp;&emsp;&nbsp; * command line interface for package management.</div>
<div>74&emsp;&emsp;&nbsp; * </div>
<div>75&emsp;&emsp;&nbsp; * @author Mark Hall (mhall{[at]}pentaho{[dot]}com)</div>
<div>76&emsp;&emsp;&nbsp; * @version $Revision: 13883 $</div>
<div>77&emsp;&emsp;&nbsp; */</div>
<div>78&emsp;&emsp;public class WekaPackageManager {</div>
<div>79&emsp;&emsp;</div>
<div>80&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for dependency injection */</div>
<div>81&emsp;&emsp;&nbsp;&nbsp;  public static final String INJECT_DEPENDENCY_KEY = "InjectDependencies";</div>
<div>82&emsp;&emsp;</div>
<div>83&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for version info */</div>
<div>84&emsp;&emsp;&nbsp;&nbsp;  public static final String VERSION_KEY = "Version";</div>
<div>85&emsp;&emsp;</div>
<div>86&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for package disablement */</div>
<div>87&emsp;&emsp;&nbsp;&nbsp;  public static final String DISABLE_KEY = "Disable";</div>
<div>88&emsp;&emsp;</div>
<div>89&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for package disablement */</div>
<div>90&emsp;&emsp;&nbsp;&nbsp;  public static final String DISABLED_KEY = "Disabled";</div>
<div>91&emsp;&emsp;</div>
<div>92&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for package preclusion */</div>
<div>93&emsp;&emsp;&nbsp;&nbsp;  public static final String PRECLUDES_KEY = "Precludes";</div>
<div>94&emsp;&emsp;</div>
<div>95&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>96&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Package metadata key for preventing load if an environment variable is not</div>
<div>97&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * set</div>
<div>98&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>99&emsp;&emsp;&nbsp;&nbsp;  public static final String DO_NOT_LOAD_IF_ENV_VAR_NOT_SET_KEY =</div>
<div>100&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "DoNotLoadIfEnvVarNotSet";</div>
<div>101&emsp;&emsp;</div>
<div>102&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>103&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Package metadata key for preventing load if an environment variable is not</div>
<div>104&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * set</div>
<div>105&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>106&emsp;&emsp;&nbsp;&nbsp;  public static final String DO_NOT_LOAD_IF_ENV_VAR_NOT_SET_MESSAGE_KEY =</div>
<div>107&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "DoNotLoadIfEnvVarNotSetMessage";</div>
<div>108&emsp;&emsp;</div>
<div>109&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for preventing load if a class is not available */</div>
<div>110&emsp;&emsp;&nbsp;&nbsp;  public static final String DO_NOT_LOAD_IF_CLASS_NOT_PRESENT_KEY =</div>
<div>111&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "DoNotLoadIfClassNotPresent";</div>
<div>112&emsp;&emsp;</div>
<div>113&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for preventing load if a class is not available */</div>
<div>114&emsp;&emsp;&nbsp;&nbsp;  public static final String DO_NOT_LOAD_IF_CLASS_NOT_PRESENT_MESSAGE_KEY =</div>
<div>115&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "DoNotLoadIfClassNotPresentMessage";</div>
<div>116&emsp;&emsp;</div>
<div>117&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for preventing load if a file is not present */</div>
<div>118&emsp;&emsp;&nbsp;&nbsp;  public static final String DO_NOT_LOAD_IF_FILE_NOT_PRESENT_KEY =</div>
<div>119&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "DoNotLoadIfFileNotPresent";</div>
<div>120&emsp;&emsp;</div>
<div>121&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for preventing load if a file is not present */</div>
<div>122&emsp;&emsp;&nbsp;&nbsp;  public static final String DO_NOT_LOAD_IF_FILE_NOT_PRESENT_MESSAGE_KEY =</div>
<div>123&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "DoNotLoadIfFileNotPresentMessage";</div>
<div>124&emsp;&emsp;</div>
<div>125&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for a message to display on installation */</div>
<div>126&emsp;&emsp;&nbsp;&nbsp;  public static final String MESSAGE_TO_DISPLAY_ON_INSTALLATION_KEY =</div>
<div>127&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "MessageToDisplayOnInstallation";</div>
<div>128&emsp;&emsp;</div>
<div>129&emsp;&emsp;&nbsp;&nbsp;  /** Package metadata key for setting system properties */</div>
<div>130&emsp;&emsp;&nbsp;&nbsp;  public static final String SET_SYSTEM_PROPERTIES_KEY = "SetSystemProperties";</div>
<div>131&emsp;&emsp;</div>
<div>132&emsp;&emsp;&nbsp;&nbsp;  /** The default folder name for Weka bits and bobs */</div>
<div>133&emsp;&emsp;&nbsp;&nbsp;  private static String WEKAFILES_DIR_NAME = "wekafiles";</div>
<div>134&emsp;&emsp;</div>
<div>135&emsp;&emsp;&nbsp;&nbsp;  /** Default path to where Weka's configuration and packages are stored */</div>
<div>136&emsp;&emsp;&nbsp;&nbsp;  public static File WEKA_HOME = new File(System.getProperty("user.home")</div>
<div>137&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    + File.separator + WEKAFILES_DIR_NAME);</div>
<div>138&emsp;&emsp;</div>
<div>139&emsp;&emsp;&nbsp;&nbsp;  /** The default packages directory */</div>
<div>140&emsp;&emsp;&nbsp;&nbsp;  public static File PACKAGES_DIR = new File(WEKA_HOME.toString()</div>
<div>141&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    + File.separator + "packages");</div>
<div>142&emsp;&emsp;</div>
<div>143&emsp;&emsp;&nbsp;&nbsp;  /** The default props dir name */</div>
<div>144&emsp;&emsp;&nbsp;&nbsp;  private static String PROPERTIES_DIR_NAME = "props";</div>
<div>145&emsp;&emsp;</div>
<div>146&emsp;&emsp;&nbsp;&nbsp;  /** The default properties directory */</div>
<div>147&emsp;&emsp;&nbsp;&nbsp;  public static File PROPERTIES_DIR = new File(WEKA_HOME.toString()</div>
<div>148&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    + File.separator + PROPERTIES_DIR_NAME);</div>
<div>149&emsp;&emsp;</div>
<div>150&emsp;&emsp;&nbsp;&nbsp;  public static String NATIVE_LIBS_DIR_NAME = "native";</div>
<div>151&emsp;&emsp;</div>
<div>152&emsp;&emsp;&nbsp;&nbsp;  /** The default native libraries directory */</div>
<div>153&emsp;&emsp;&nbsp;&nbsp;  public static File NATIVE_LIBS_DIR = new File(WEKA_HOME.toString()</div>
<div>154&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    + File.separator + NATIVE_LIBS_DIR_NAME);</div>
<div>155&emsp;&emsp;</div>
<div>156&emsp;&emsp;&nbsp;&nbsp;  /** The underlying package manager */</div>
<div>157&emsp;&emsp;&nbsp;&nbsp;  private static PackageManager PACKAGE_MANAGER = PackageManager.create();</div>
<div>158&emsp;&emsp;</div>
<div>159&emsp;&emsp;&nbsp;&nbsp;  /** Current repository URL to use */</div>
<div>160&emsp;&emsp;&nbsp;&nbsp;  private static URL REP_URL;</div>
<div>161&emsp;&emsp;</div>
<div>162&emsp;&emsp;&nbsp;&nbsp;  /** Location of the repository cache */</div>
<div>163&emsp;&emsp;&nbsp;&nbsp;  private static URL CACHE_URL;</div>
<div>164&emsp;&emsp;</div>
<div>165&emsp;&emsp;&nbsp;&nbsp;  /** True if a cache build is required */</div>
<div>166&emsp;&emsp;&nbsp;&nbsp;  private static boolean INITIAL_CACHE_BUILD_NEEDED = false;</div>
<div>167&emsp;&emsp;</div>
<div>168&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>169&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * The name of the file that contains the list of packages in the repository</div>
<div>170&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>171&emsp;&emsp;&nbsp;&nbsp;  private static String PACKAGE_LIST_FILENAME = "packageListWithVersion.txt";</div>
<div>172&emsp;&emsp;</div>
<div>173&emsp;&emsp;&nbsp;&nbsp;  /** Primary repository */</div>
<div>174&emsp;&emsp;&nbsp;&nbsp;  private static String PRIMARY_REPOSITORY =</div>
<div>175&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "http://weka.sourceforge.net/packageMetaData";</div>
<div>176&emsp;&emsp;</div>
<div>177&emsp;&emsp;&nbsp;&nbsp;  /** Backup mirror of the repository */</div>
<div>178&emsp;&emsp;&nbsp;&nbsp;  private static String REP_MIRROR;</div>
<div>179&emsp;&emsp;</div>
<div>180&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>181&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * True if the user has specified a custom repository via a property in</div>
<div>182&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * PackageManager.props</div>
<div>183&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>184&emsp;&emsp;&nbsp;&nbsp;  private static boolean USER_SET_REPO = false;</div>
<div>185&emsp;&emsp;</div>
<div>186&emsp;&emsp;&nbsp;&nbsp;  /** The package manager's property file */</div>
<div>187&emsp;&emsp;&nbsp;&nbsp;  private static String PACKAGE_MANAGER_PROPS_FILE_NAME =</div>
<div>188&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "PackageManager.props";</div>
<div>189&emsp;&emsp;</div>
<div>190&emsp;&emsp;&nbsp;&nbsp;  /** Operating offline? */</div>
<div>191&emsp;&emsp;&nbsp;&nbsp;  public static boolean m_offline;</div>
<div>192&emsp;&emsp;</div>
<div>193&emsp;&emsp;&nbsp;&nbsp;  /** Load packages? */</div>
<div>194&emsp;&emsp;&nbsp;&nbsp;  private static boolean m_loadPackages = true;</div>
<div>195&emsp;&emsp;</div>
<div>196&emsp;&emsp;&nbsp;&nbsp;  /** Established WEKA_HOME successfully? */</div>
<div>197&emsp;&emsp;&nbsp;&nbsp;  protected static boolean m_wekaHomeEstablished;</div>
<div>198&emsp;&emsp;</div>
<div>199&emsp;&emsp;&nbsp;&nbsp;  /** Packages loaded OK? */</div>
<div>200&emsp;&emsp;&nbsp;&nbsp;  protected static boolean m_packagesLoaded;</div>
<div>201&emsp;&emsp;</div>
<div>202&emsp;&emsp;&nbsp;&nbsp;  /** File to check against server for new/updated packages */</div>
<div>203&emsp;&emsp;&nbsp;&nbsp;  protected static final String PACKAGE_LIST_WITH_VERSION_FILE =</div>
<div>204&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "packageListWithVersion.txt";</div>
<div>205&emsp;&emsp;</div>
<div>206&emsp;&emsp;&nbsp;&nbsp;  /** File to check against server equivalent for forced refresh */</div>
<div>207&emsp;&emsp;&nbsp;&nbsp;  protected static final String FORCED_REFRESH_COUNT_FILE =</div>
<div>208&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    "forcedRefreshCount.txt";</div>
<div>209&emsp;&emsp;</div>
<div>210&emsp;&emsp;&nbsp;&nbsp;  /** Package loading in progress? */</div>
<div>211&emsp;&emsp;&nbsp;&nbsp;  public static boolean m_initialPackageLoadingInProcess = false;</div>
<div>212&emsp;&emsp;</div>
<div>213&emsp;&emsp;&nbsp;&nbsp;  /* True if an initial cache build is needed and working offline */</div>
<div>214&emsp;&emsp;&nbsp;&nbsp;  public static boolean m_noPackageMetaDataAvailable;</div>
<div>215&emsp;&emsp;</div>
<div>216&emsp;&emsp;&nbsp;&nbsp;  /** The set of packages that the user has requested not to load */</div>
<div>217&emsp;&emsp;&nbsp;&nbsp;  public static Set&#60;String> m_doNotLoadList;</div>
<div>218&emsp;&emsp;</div>
<div>219&emsp;&emsp;&nbsp;&nbsp;  static {</div>
<div>220&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    establishWekaHome();</div>
<div>221&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // make sure MTJ classes are injected to the root classloader</div>
<div>222&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // so that MTJ native library loading can see them</div>
<div>223&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>224&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .injectMTJCoreClasses();</div>
<div>225&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>226&emsp;&emsp;</div>
<div>227&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>228&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Establish WEKA_HOME if needed</div>
<div>229&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>230&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if WEKA_HOME was successfully established</div>
<div>231&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>232&emsp;&emsp;&nbsp;&nbsp;  protected static boolean establishWekaHome() {</div>
<div style="background-color:limegreen;">233&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (m_wekaHomeEstablished) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>234&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return true;</div>
<div>235&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>236&emsp;&emsp;</div>
<div>237&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // process core PluginManager.props before any from packages.</div>
<div>238&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // This is to have some control over the order of certain plugins</div>
<div>239&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>240&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PluginManager.addFromProperties(WekaPackageManager.class.getClassLoader()</div>
<div>241&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        .getResourceAsStream("weka/PluginManager.props"), true);</div>
<div>242&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>243&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      log(Logger.Level.WARNING,</div>
<div>244&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        "[WekaPackageManager] unable to read weka/PluginManager.props");</div>
<div>245&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>246&emsp;&emsp;</div>
<div>247&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // look to see if WEKA_HOME has been defined as an environment</div>
<div>248&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // variable</div>
<div>249&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Environment env = Environment.getSystemWide();</div>
<div>250&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String wh = env.getVariableValue("WEKA_HOME");</div>
<div style="background-color:limegreen;">251&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (wh != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>252&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      WEKA_HOME = new File(wh);</div>
<div>253&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGES_DIR = new File(wh + File.separator + "packages");</div>
<div>254&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PROPERTIES_DIR = new File(wh + File.separator + PROPERTIES_DIR_NAME);</div>
<div>255&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      NATIVE_LIBS_DIR = new File(wh + File.separator + NATIVE_LIBS_DIR_NAME);</div>
<div>256&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } else {</div>
<div>257&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      env.addVariableSystemWide("WEKA_HOME", WEKA_HOME.toString());</div>
<div>258&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>259&emsp;&emsp;</div>
<div>260&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String nativePath = System.getProperty("java.library.path", "");</div>
<div style="background-color:limegreen;">261&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!nativePath.contains(NATIVE_LIBS_DIR.toString())) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>262&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      nativePath += File.pathSeparator + NATIVE_LIBS_DIR.toString();</div>
<div>263&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.setProperty("java.library.path", nativePath);</div>
<div>264&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>265&emsp;&emsp;</div>
<div>266&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean ok = true;</div>
<div style="background-color:limegreen;">267&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!WEKA_HOME.exists()) {&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>268&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // create it for the user</div>
<div style="background-color:limegreen;">269&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (!WEKA_HOME.mkdir()) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>270&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Unable to create WEKA_HOME ("</div>
<div>271&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + WEKA_HOME.getAbsolutePath() + ")");</div>
<div>272&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ok = false;</div>
<div>273&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>274&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>275&emsp;&emsp;</div>
<div style="background-color:limegreen;">276&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!PACKAGES_DIR.exists()) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>277&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // create the packages dir</div>
<div style="background-color:limegreen;">278&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (!PACKAGES_DIR.mkdir()) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>279&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Unable to create packages directory ("</div>
<div>280&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + PACKAGES_DIR.getAbsolutePath() + ")");</div>
<div>281&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ok = false;</div>
<div>282&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>283&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>284&emsp;&emsp;</div>
<div style="background-color:limegreen;">285&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!NATIVE_LIBS_DIR.exists()) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">286&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (!NATIVE_LIBS_DIR.mkdir()) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>287&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Unable to create native libs directory ("</div>
<div>288&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + NATIVE_LIBS_DIR.getAbsolutePath() + ")");</div>
<div>289&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>290&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>291&emsp;&emsp;</div>
<div>292&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    m_wekaHomeEstablished = ok;</div>
<div>293&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.setPackageHome(PACKAGES_DIR);</div>
<div>294&emsp;&emsp;</div>
<div>295&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    m_doNotLoadList = getDoNotLoadList();</div>
<div>296&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>297&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // setup the backup mirror first</div>
<div>298&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // establishMirror();</div>
<div>299&emsp;&emsp;</div>
<div>300&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // user-supplied repository URL takes precedence over anything else</div>
<div>301&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String repURL =</div>
<div>302&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        env.getVariableValue("weka.core.wekaPackageRepositoryURL");</div>
<div style="background-color:limegreen;">303&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (repURL == null || repURL.length() == 0) {&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR]</b></div>
<div>304&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // See if there is a URL named in</div>
<div>305&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // $WEKA_HOME/props/PackageRepository.props</div>
<div>306&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        File repPropsFile =</div>
<div>307&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          new File(PROPERTIES_DIR.toString() + File.separator</div>
<div>308&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + "PackageRepository.props");</div>
<div>309&emsp;&emsp;</div>
<div style="background-color:limegreen;">310&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (repPropsFile.exists()) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>311&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Properties repProps = new Properties();</div>
<div>312&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          repProps.load(new FileInputStream(repPropsFile));</div>
<div>313&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          repURL = repProps.getProperty("weka.core.wekaPackageRepositoryURL");</div>
<div>314&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>315&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>316&emsp;&emsp;</div>
<div style="background-color:limegreen;">317&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (repURL == null || repURL.length() == 0) {&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR]</b></div>
<div>318&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        repURL = PRIMARY_REPOSITORY;</div>
<div>319&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>320&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        log(weka.core.logging.Logger.Level.INFO,</div>
<div>321&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          "[WekaPackageManager] weka.core.WekaPackageRepositoryURL = " + repURL);</div>
<div>322&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // System.err.println("[WekaPackageManager]</div>
<div>323&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // weka.core.WekaPackageRepositoryURL = "</div>
<div>324&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // + repURL);</div>
<div>325&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        USER_SET_REPO = true;</div>
<div>326&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>327&emsp;&emsp;</div>
<div>328&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      REP_URL = new URL(repURL);</div>
<div>329&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>330&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (MalformedURLException ex) {</div>
<div>331&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>332&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (IOException ex) {</div>
<div>333&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>334&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>335&emsp;&emsp;</div>
<div>336&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.setBaseSystemName("weka");</div>
<div>337&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.setBaseSystemVersion(weka.core.Version.VERSION);</div>
<div>338&emsp;&emsp;</div>
<div>339&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // Now check the cache and establish it if necessary</div>
<div>340&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File cacheDir =</div>
<div>341&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      new File(WEKA_HOME.toString() + File.separator + "repCache");</div>
<div>342&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>343&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String tempCacheString = "file://" + cacheDir.toString();</div>
<div>344&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // sanitize URI and fix slashes (for Windows)</div>
<div>345&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      tempCacheString = tempCacheString.replace(" ", "%20");</div>
<div>346&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      tempCacheString = tempCacheString.replace('\\', '/');</div>
<div style="background-color:limegreen;">347&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (tempCacheString.startsWith("file://")&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">348&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        && !tempCacheString.startsWith("file:///")) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>349&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        tempCacheString = tempCacheString.substring(7);</div>
<div>350&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        tempCacheString = "file:///" + tempCacheString;</div>
<div>351&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>352&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URI tempURI = new URI(tempCacheString);</div>
<div>353&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // System.err.println(" -- " + tempURI.toString());</div>
<div>354&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      CACHE_URL = tempURI.toURL();</div>
<div>355&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception e) {</div>
<div>356&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      e.printStackTrace();</div>
<div>357&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>358&emsp;&emsp;</div>
<div>359&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File packagesList =</div>
<div>360&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      new File(cacheDir.getAbsolutePath() + File.separator</div>
<div>361&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + PACKAGE_LIST_FILENAME);</div>
<div style="background-color:limegreen;">362&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!cacheDir.exists()) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">363&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (!cacheDir.mkdir()) {&nbsp;&#8594; [PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>364&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Unable to create repository cache directory ("</div>
<div>365&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + cacheDir.getAbsolutePath() + ")");</div>
<div>366&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        log(</div>
<div>367&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          weka.core.logging.Logger.Level.WARNING,</div>
<div>368&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          "Unable to create repository cache directory ("</div>
<div>369&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + cacheDir.getAbsolutePath() + ")");</div>
<div>370&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        CACHE_URL = null;</div>
<div>371&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>372&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // refreshCache();</div>
<div>373&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        INITIAL_CACHE_BUILD_NEEDED = true;</div>
<div>374&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>375&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>376&emsp;&emsp;</div>
<div style="background-color:limegreen;">377&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!packagesList.exists()) {&nbsp;&#8594; [PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>378&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      INITIAL_CACHE_BUILD_NEEDED = true;</div>
<div>379&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>380&emsp;&emsp;</div>
<div>381&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // Package manager general properties</div>
<div>382&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // Set via system props first</div>
<div>383&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String offline = env.getVariableValue("weka.packageManager.offline");</div>
<div style="background-color:limegreen;">384&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (offline != null) {&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>385&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      m_offline = offline.equalsIgnoreCase("true");</div>
<div>386&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>387&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String loadPackages =</div>
<div>388&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      env.getVariableValue("weka.packageManager.loadPackages");</div>
<div style="background-color:limegreen;">389&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (loadPackages == null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>390&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // try legacy</div>
<div>391&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      loadPackages = env.getVariableValue("weka.core.loadPackages");</div>
<div>392&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>393&emsp;&emsp;</div>
<div style="background-color:limegreen;">394&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (loadPackages != null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>395&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      m_loadPackages = loadPackages.equalsIgnoreCase("true");</div>
<div>396&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>397&emsp;&emsp;</div>
<div>398&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // load any general package manager properties from props file</div>
<div>399&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File generalProps =</div>
<div>400&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      new File(PROPERTIES_DIR.toString() + File.separator</div>
<div>401&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + PACKAGE_MANAGER_PROPS_FILE_NAME);</div>
<div style="background-color:limegreen;">402&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (generalProps.exists()) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>403&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Properties gProps = new Properties();</div>
<div>404&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>405&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        gProps.load(new FileInputStream(generalProps));</div>
<div>406&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // this one takes precedence over the legacy one</div>
<div>407&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String repURL =</div>
<div>408&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          gProps.getProperty("weka.core.wekaPackageRepositoryURL");</div>
<div style="background-color:limegreen;">409&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (repURL != null && repURL.length() > 0) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>410&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          REP_URL = new URL(repURL);</div>
<div>411&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>412&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>413&emsp;&emsp;</div>
<div>414&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        offline = gProps.getProperty("weka.packageManager.offline");</div>
<div>415&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (offline != null && offline.length() > 0) {</div>
<div>416&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          m_offline = offline.equalsIgnoreCase("true");</div>
<div>417&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>418&emsp;&emsp;</div>
<div>419&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        loadPackages = gProps.getProperty("weka.packageManager.loadPackages");</div>
<div>420&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (loadPackages == null) {</div>
<div>421&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // try legacy</div>
<div>422&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          loadPackages = env.getVariableValue("weka.core.loadPackages");</div>
<div>423&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>424&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (loadPackages != null) {</div>
<div>425&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          m_loadPackages = loadPackages.equalsIgnoreCase("true");</div>
<div>426&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>427&emsp;&emsp;</div>
<div>428&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String pluginManagerDisableList =</div>
<div>429&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          gProps.getProperty("weka.pluginManager.disable");</div>
<div>430&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (pluginManagerDisableList != null</div>
<div>431&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          && pluginManagerDisableList.length() > 0) {</div>
<div>432&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          List&#60;String> disable = new ArrayList&#60;String>();</div>
<div>433&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String[] parts = pluginManagerDisableList.split(",");</div>
<div>434&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          for (String s : parts) {</div>
<div>435&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            disable.add(s.trim());</div>
<div>436&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>437&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          PluginManager.addToDisabledList(disable);</div>
<div>438&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>439&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (FileNotFoundException e) {</div>
<div>440&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        e.printStackTrace();</div>
<div>441&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (IOException e) {</div>
<div>442&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        e.printStackTrace();</div>
<div>443&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>444&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>445&emsp;&emsp;</div>
<div style="background-color:limegreen;">446&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (INITIAL_CACHE_BUILD_NEEDED && m_offline) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES] & [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>447&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      m_noPackageMetaDataAvailable = true;</div>
<div>448&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>449&emsp;&emsp;</div>
<div>450&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // Pass a valid http URL to the setProxyAuthentication()</div>
<div>451&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // method to ensure that a proxy or direct connection</div>
<div>452&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // is configured initially. This will prevent this method from</div>
<div>453&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // trying to configure the ProxySelector and proxy</div>
<div>454&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // via the file-based CACHE_URL somewhere down the track</div>
<div>455&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>456&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.setProxyAuthentication(REP_URL);</div>
<div>457&emsp;&emsp;</div>
<div>458&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return ok;</div>
<div>459&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>460&emsp;&emsp;</div>
<div>461&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>462&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Establish the location of a mirror</div>
<div>463&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>464&emsp;&emsp;&nbsp;&nbsp;  protected static void establishMirror() {</div>
<div style="background-color:limegreen;">465&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (m_offline) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>466&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return;</div>
<div>467&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>468&emsp;&emsp;</div>
<div>469&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>470&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String mirrorListURL =</div>
<div>471&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        "http://www.cs.waikato.ac.nz/ml/weka/packageMetaDataMirror.txt";</div>
<div>472&emsp;&emsp;</div>
<div>473&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URLConnection conn = null;</div>
<div>474&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URL connURL = new URL(mirrorListURL);</div>
<div>475&emsp;&emsp;</div>
<div style="background-color:limegreen;">476&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (PACKAGE_MANAGER.setProxyAuthentication(connURL)) {&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>477&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection(PACKAGE_MANAGER.getProxy());</div>
<div>478&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>479&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection();</div>
<div>480&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>481&emsp;&emsp;</div>
<div>482&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      conn.setConnectTimeout(10000); // timeout after 10 seconds</div>
<div>483&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      conn.setReadTimeout(10000);</div>
<div>484&emsp;&emsp;</div>
<div>485&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedReader bi =</div>
<div>486&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedReader(new InputStreamReader(conn.getInputStream()));</div>
<div>487&emsp;&emsp;</div>
<div>488&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      REP_MIRROR = bi.readLine();</div>
<div>489&emsp;&emsp;</div>
<div>490&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div style="background-color:limegreen;">491&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (REP_MIRROR != null && REP_MIRROR.length() > 0) {&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR]</b></div>
<div>492&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // use the mirror if it is different from the primary repo</div>
<div>493&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // and the user hasn't specified an explicit repo via the</div>
<div>494&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // property</div>
<div style="background-color:limegreen;">495&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (!REP_MIRROR.equals(PRIMARY_REPOSITORY) && !USER_SET_REPO) {&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR]</b></div>
<div>496&emsp;&emsp;</div>
<div>497&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          log(weka.core.logging.Logger.Level.INFO,</div>
<div>498&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            "[WekaPackageManager] Package manager using repository mirror: "</div>
<div>499&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + REP_MIRROR);</div>
<div>500&emsp;&emsp;</div>
<div>501&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          REP_URL = new URL(REP_MIRROR);</div>
<div>502&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>503&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>504&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>505&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      log(weka.core.logging.Logger.Level.WARNING,</div>
<div>506&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        "[WekaPackageManager] The repository meta data mirror file seems "</div>
<div>507&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "to be unavailable (" + ex.getMessage() + ")");</div>
<div>508&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>509&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>510&emsp;&emsp;</div>
<div>511&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>512&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Write to the weka log</div>
<div>513&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>514&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param level logging level</div>
<div>515&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param message message to write</div>
<div>516&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>517&emsp;&emsp;&nbsp;&nbsp;  protected static void</div>
<div>518&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    log(weka.core.logging.Logger.Level level, String message) {</div>
<div>519&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>520&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      File logFile =</div>
<div>521&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new File(WEKA_HOME.toString() + File.separator + "weka.log");</div>
<div>522&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedWriter writer = new BufferedWriter(new FileWriter(logFile, true));</div>
<div>523&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");</div>
<div>524&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String linefeed = System.getProperty("line.separator");</div>
<div>525&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String m =</div>
<div>526&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        format.format(new Date()) + " " + level + ": " + message + linefeed;</div>
<div>527&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      writer.write(m);</div>
<div>528&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      writer.flush();</div>
<div>529&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      writer.close();</div>
<div>530&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>531&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>532&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>533&emsp;&emsp;</div>
<div>534&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>535&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Remove any ExplorerDefaults properties specified in the supplied package</div>
<div>536&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>537&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param installedPackageName the package specifying properties that should</div>
<div>538&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          be removed from ExplorerDefaults</div>
<div>539&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>540&emsp;&emsp;&nbsp;&nbsp;  public static void removeExplorerProps(String installedPackageName) {</div>
<div>541&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>542&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Properties expProps = new Properties();</div>
<div>543&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String explorerProps =</div>
<div>544&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        getPackageHome().getAbsolutePath() + File.separator</div>
<div>545&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + installedPackageName + File.separator + "Explorer.props";</div>
<div>546&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedInputStream bi =</div>
<div>547&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedInputStream(new FileInputStream(explorerProps));</div>
<div>548&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      expProps.load(bi);</div>
<div>549&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div>550&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi = null;</div>
<div>551&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Set&#60;Object> keys = expProps.keySet();</div>
<div>552&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Iterator&#60;Object> keysI = keys.iterator();</div>
<div>553&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      while (keysI.hasNext()) {</div>
<div>554&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String key = (String) keysI.next();</div>
<div>555&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (!key.endsWith("Policy")) {</div>
<div>556&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // See if this key is in the Explorer props</div>
<div>557&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String existingVal = ExplorerDefaults.get(key, "");</div>
<div>558&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String toRemove = expProps.getProperty(key);</div>
<div>559&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (existingVal.length() > 0) {</div>
<div>560&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // cover the case when the value to remove is at the start</div>
<div>561&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // or middle of a list</div>
<div>562&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            existingVal = existingVal.replace(toRemove + ",", "");</div>
<div>563&emsp;&emsp;</div>
<div>564&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // the case when it's at the end</div>
<div>565&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            existingVal = existingVal.replace("," + toRemove, "");</div>
<div>566&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            ExplorerDefaults.set(key, existingVal);</div>
<div>567&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>568&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>569&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>570&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>571&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>572&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>573&emsp;&emsp;</div>
<div>574&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>575&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Process a package's GenericPropertiesCreator.props file</div>
<div>576&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>577&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param propsFile the props file to process</div>
<div>578&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>579&emsp;&emsp;&nbsp;&nbsp;  protected static void processGenericPropertiesCreatorProps(File propsFile) {</div>
<div>580&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>581&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Properties expProps = new Properties();</div>
<div>582&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedInputStream bi =</div>
<div>583&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedInputStream(new FileInputStream(propsFile));</div>
<div>584&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      expProps.load(bi);</div>
<div>585&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div>586&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi = null;</div>
<div>587&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Properties GPCInputProps =</div>
<div>588&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        GenericPropertiesCreator.getGlobalInputProperties();</div>
<div>589&emsp;&emsp;</div>
<div>590&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Set&#60;Object> keys = expProps.keySet();</div>
<div>591&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Iterator&#60;Object> keysI = keys.iterator();</div>
<div style="background-color:limegreen;">592&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      while (keysI.hasNext()) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>593&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String key = (String) keysI.next();</div>
<div>594&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // see if this key is in the GPC input props</div>
<div>595&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String existingVal = GPCInputProps.getProperty(key, "");</div>
<div style="background-color:limegreen;">596&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (existingVal.length() > 0) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>597&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // append</div>
<div>598&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String newVal = expProps.getProperty(key);</div>
<div>599&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // only append if this value is not already there!!</div>
<div style="background-color:limegreen;">600&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          if (existingVal.indexOf(newVal) &#60; 0) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>601&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            newVal = existingVal + "," + newVal;</div>
<div>602&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            GPCInputProps.put(key, newVal);</div>
<div>603&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>604&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</div>
<div>605&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // simply add this new key/value combo</div>
<div>606&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String newVal = expProps.getProperty(key);</div>
<div>607&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          GPCInputProps.put(key, newVal);</div>
<div>608&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>609&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>610&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>611&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // ignore</div>
<div>612&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>613&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>614&emsp;&emsp;</div>
<div>615&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>616&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Process a package's Explorer.props file</div>
<div>617&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>618&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param propsFile the properties file to process</div>
<div>619&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>620&emsp;&emsp;&nbsp;&nbsp;  protected static void processExplorerProps(File propsFile) {</div>
<div>621&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>622&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Properties expProps = new Properties();</div>
<div>623&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedInputStream bi =</div>
<div>624&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedInputStream(new FileInputStream(propsFile));</div>
<div>625&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      expProps.load(bi);</div>
<div>626&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div>627&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi = null;</div>
<div>628&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Set&#60;Object> keys = expProps.keySet();</div>
<div>629&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Iterator&#60;Object> keysI = keys.iterator();</div>
<div style="background-color:limegreen;">630&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      while (keysI.hasNext()) {&nbsp;&#8594; [PRUNE]</b></div>
<div>631&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String key = (String) keysI.next();</div>
<div>632&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (!key.endsWith("Policy")) {</div>
<div>633&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // See if this key is in the Explorer props</div>
<div>634&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String existingVal = ExplorerDefaults.get(key, "");</div>
<div>635&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (existingVal.length() > 0) {</div>
<div>636&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // get the replacement policy (if any)</div>
<div>637&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            String replacePolicy = expProps.getProperty(key + "Policy");</div>
<div>638&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (replacePolicy != null && replacePolicy.length() > 0) {</div>
<div>639&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              if (replacePolicy.equalsIgnoreCase("replace")) {</div>
<div>640&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                String newVal = expProps.getProperty(key);</div>
<div>641&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                ExplorerDefaults.set(key, newVal);</div>
<div>642&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              } else {</div>
<div>643&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                // default to append</div>
<div>644&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                String newVal = expProps.getProperty(key);</div>
<div>645&emsp;&emsp;</div>
<div>646&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                // only append if this value is not already there!!</div>
<div>647&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (existingVal.indexOf(newVal) &#60; 0) {</div>
<div>648&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  newVal = existingVal + "," + newVal;</div>
<div>649&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  ExplorerDefaults.set(key, newVal);</div>
<div>650&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                }</div>
<div>651&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              }</div>
<div>652&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            } else {</div>
<div>653&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              // default to append</div>
<div>654&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              String newVal = expProps.getProperty(key);</div>
<div>655&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              // only append if this value is not already there!!</div>
<div>656&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              if (existingVal.indexOf(newVal) &#60; 0) {</div>
<div>657&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                newVal = existingVal + "," + newVal;</div>
<div>658&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                ExplorerDefaults.set(key, newVal);</div>
<div>659&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              }</div>
<div>660&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>661&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          } else {</div>
<div>662&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // simply add this new key/value combo</div>
<div>663&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            String newVal = expProps.getProperty(key);</div>
<div>664&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            ExplorerDefaults.set(key, newVal);</div>
<div>665&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>666&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>667&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>668&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>669&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // ignore</div>
<div>670&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>671&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>672&emsp;&emsp;</div>
<div>673&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>674&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Process a package's GUIEditors.props file</div>
<div>675&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>676&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param propsFile the properties file to process</div>
<div>677&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param verbose true to output more info</div>
<div>678&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>679&emsp;&emsp;&nbsp;&nbsp;  protected static void processGUIEditorsProps(File propsFile, boolean verbose) {</div>
<div>680&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    GenericObjectEditor.registerEditors();</div>
<div>681&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>682&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Properties editorProps = new Properties();</div>
<div>683&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedInputStream bi =</div>
<div>684&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedInputStream(new FileInputStream(propsFile));</div>
<div>685&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      editorProps.load(bi);</div>
<div>686&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div>687&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi = null;</div>
<div>688&emsp;&emsp;</div>
<div>689&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Enumeration&#60;?> enm = editorProps.propertyNames();</div>
<div>690&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      while (enm.hasMoreElements()) {</div>
<div>691&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String name = enm.nextElement().toString();</div>
<div>692&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String value = editorProps.getProperty(name, "");</div>
<div>693&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (verbose) {</div>
<div>694&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.err.println("Registering " + name + " " + value);</div>
<div>695&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>696&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        GenericObjectEditor.registerEditor(name, value);</div>
<div>697&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>698&emsp;&emsp;</div>
<div>699&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>700&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // ignore</div>
<div>701&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>702&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>703&emsp;&emsp;</div>
<div>704&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>705&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Process a package's PluginManager.props file</div>
<div>706&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>707&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package that owns this PluginManager</div>
<div>708&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          props file</div>
<div>709&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param propsFile the properties file to process</div>
<div>710&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>711&emsp;&emsp;&nbsp;&nbsp;  protected static void processPluginManagerProps(String packageName,</div>
<div>712&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File propsFile) {</div>
<div>713&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>714&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PluginManager.addFromProperties(packageName, propsFile);</div>
<div>715&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>716&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>717&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>718&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>719&emsp;&emsp;</div>
<div>720&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>721&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Process properties in a package directory</div>
<div>722&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>723&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param directory the package directory to process</div>
<div>724&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param verbose true for verbose output</div>
<div>725&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param goePropsFiles store any GenericObjectEditor.props files for</div>
<div>726&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          post-processing after all jars have been loaded</div>
<div>727&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>728&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>729&emsp;&emsp;&nbsp;&nbsp;  protected static void processPackageDirectory(File directory,</div>
<div>730&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean verbose, List&#60;File> goePropsFiles,</div>
<div>731&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean avoidTriggeringFullClassDiscovery) throws Exception {</div>
<div>732&emsp;&emsp;</div>
<div>733&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File[] contents = directory.listFiles();</div>
<div>734&emsp;&emsp;</div>
<div style="background-color:limegreen;">735&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (contents != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>736&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // make sure that jar files and lib directory get processed first</div>
<div>737&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      /*</div>
<div>738&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * for (File content : contents) { if (content.isFile() &&</div>
<div>739&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * content.getPath().endsWith(".jar")) { if (verbose) {</div>
<div>740&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * System.out.println("[WekaPackageManager] loading " + content.getPath()); }</div>
<div>741&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * ClassloaderUtil.addFile(content.getPath());</div>
<div>742&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * </div>
<div>743&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * } else if (content.isDirectory() &&</div>
<div>744&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * content.getName().equalsIgnoreCase("lib")) { // add any jar files in</div>
<div>745&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * the lib directory to the classpath processPackageDirectory(content,</div>
<div>746&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       * verbose, goePropsFiles, avoidTriggeringFullClassDiscovery); } }</div>
<div>747&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       */</div>
<div>748&emsp;&emsp;</div>
<div>749&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // now any auxilliary files</div>
<div style="background-color:limegreen;">750&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (File content : contents) {&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">751&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (content.isFile() && content.getPath().endsWith("Beans.props")) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS] & [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>752&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // KnowledgeFlow plugin -- add the Beans.props file to the list of</div>
<div>753&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // bean plugin props</div>
<div>754&emsp;&emsp;</div>
<div>755&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          BeansProperties.addToPluginBeanProps(content);</div>
<div>756&emsp;&emsp;</div>
<div style="background-color:limegreen;">757&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          if (!avoidTriggeringFullClassDiscovery) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>758&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            KnowledgeFlowApp.disposeSingleton();</div>
<div>759&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div style="background-color:limegreen;">760&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        } else if (content.isFile()&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div style="background-color:limegreen;">761&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          && content.getPath().endsWith("Explorer.props")&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>762&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          && !avoidTriggeringFullClassDiscovery) {</div>
<div>763&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // Explorer tabs plugin</div>
<div>764&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // process the keys in the properties file and append/add values</div>
<div>765&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          processExplorerProps(content);</div>
<div style="background-color:limegreen;">766&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        } else if (content.isFile()&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div style="background-color:limegreen;">767&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          && content.getPath().endsWith("GUIEditors.props")&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR]</b></div>
<div>768&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          && !avoidTriggeringFullClassDiscovery) {</div>
<div>769&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // Editor for a particular component</div>
<div>770&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          processGUIEditorsProps(content, verbose);</div>
<div style="background-color:limegreen;">771&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        } else if (content.isFile()&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div style="background-color:limegreen;">772&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          && content.getPath().endsWith("GenericPropertiesCreator.props")&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR]</b></div>
<div>773&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          && !avoidTriggeringFullClassDiscovery) {</div>
<div style="background-color:limegreen;">774&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          if (goePropsFiles != null) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>775&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            goePropsFiles.add(content);</div>
<div>776&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          } else {</div>
<div>777&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            processGenericPropertiesCreatorProps(content);</div>
<div>778&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div style="background-color:limegreen;">779&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        } else if (content.isFile()&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div style="background-color:limegreen;">780&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          && content.getPath().endsWith("PluginManager.props")) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>781&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          processPluginManagerProps(directory.getName(), content);</div>
<div>782&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>783&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>784&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>785&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>786&emsp;&emsp;</div>
<div>787&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>788&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Check to see if the named package has been loaded successfully</div>
<div>789&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>790&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param toCheck the name of the package to check for</div>
<div>791&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if the named package has been loaded successfully</div>
<div>792&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>793&emsp;&emsp;&nbsp;&nbsp;  public static boolean hasBeenLoaded(Package toCheck) {</div>
<div>794&emsp;&emsp;</div>
<div>795&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // if it loaded successfully, passed all integrity checks etc., then there</div>
<div>796&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // will be package classloader for it</div>
<div>797&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>798&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .getPackageClassLoader(toCheck.getName()) != null;</div>
<div>799&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>800&emsp;&emsp;</div>
<div>801&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>802&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Check whether a package should be loaded or not. Checks for missing</div>
<div>803&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * classes, unset environment variables, missing dependencies etc.</div>
<div>804&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>805&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param toLoad the package to check</div>
<div>806&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageRoot the root directory of the package</div>
<div>807&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress for reporting loading progress</div>
<div>808&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if the package is good to load</div>
<div>809&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>810&emsp;&emsp;&nbsp;&nbsp;  public static boolean loadCheck(Package toLoad, File packageRoot,</div>
<div>811&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PrintStream... progress) {</div>
<div>812&emsp;&emsp;</div>
<div>813&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // first check against the base version of the system</div>
<div>814&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean load;</div>
<div>815&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>816&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      load = toLoad.isCompatibleBaseSystem();</div>
<div>817&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>818&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>819&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return false;</div>
<div>820&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>821&emsp;&emsp;</div>
<div style="background-color:limegreen;">822&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!load) {&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">823&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>824&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        p.println("[WekaPackageManager] Skipping package " + toLoad.getName()</div>
<div>825&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + " because it is not compatible with Weka "</div>
<div>826&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + PACKAGE_MANAGER.getBaseSystemVersion().toString());</div>
<div>827&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>828&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return false;</div>
<div>829&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>830&emsp;&emsp;</div>
<div>831&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // check to see if this package has been disabled for all users</div>
<div>832&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>833&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Package repoP =</div>
<div>834&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        getRepositoryPackageInfo(toLoad.getName(), toLoad</div>
<div>835&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .getPackageMetaDataElement(VERSION_KEY).toString());</div>
<div style="background-color:limegreen;">836&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (repoP != null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>837&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Object disabled = repoP.getPackageMetaDataElement(DISABLED_KEY);</div>
<div style="background-color:limegreen;">838&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (disabled == null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>839&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          disabled = repoP.getPackageMetaDataElement(DISABLE_KEY);</div>
<div>840&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div style="background-color:limegreen;">841&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (disabled != null && disabled.toString().equalsIgnoreCase("true")) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS] & [PRUNE, CHECKERROR, FOLDS]</b></div>
<div style="background-color:limegreen;">842&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>843&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            p.println("[WekaPackageManager] Skipping package " + toLoad.getName()</div>
<div>844&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + " because it has been marked as disabled at the repository");</div>
<div>845&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>846&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return false;</div>
<div>847&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>848&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>849&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>850&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // Ignore - we will get an exception when checking for an unofficial</div>
<div>851&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // package</div>
<div>852&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return true;</div>
<div>853&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>854&emsp;&emsp;</div>
<div>855&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // check for precludes</div>
<div>856&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Object precludes = toLoad.getPackageMetaDataElement(PRECLUDES_KEY);</div>
<div style="background-color:limegreen;">857&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (precludes != null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>858&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>859&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Package> installed = getInstalledPackages();</div>
<div>860&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Package> preclusions = toLoad.getPrecludedPackages(installed);</div>
<div style="background-color:limegreen;">861&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (preclusions.size() > 0) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div style="background-color:limegreen;">862&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>863&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            p.println("[WekaPackageManager] Skipping package " + toLoad.getName()</div>
<div>864&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + " because it precludes one or more packages that are "</div>
<div>865&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + "already installed: ");</div>
<div>866&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            for (Package prec : preclusions) {</div>
<div>867&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              p.println("\t" + prec);</div>
<div>868&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>869&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>870&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return false;</div>
<div>871&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>872&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (Exception ex) {</div>
<div>873&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ex.printStackTrace();</div>
<div>874&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>875&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>876&emsp;&emsp;</div>
<div style="background-color:limegreen;">877&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    load = !m_doNotLoadList.contains(toLoad.getName());&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">878&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!load) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">879&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>880&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        p.println("[WekaPackageManager] Skipping package " + toLoad.getName()</div>
<div>881&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + " because it is has been marked as do not load");</div>
<div>882&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>883&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return false;</div>
<div>884&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>885&emsp;&emsp;</div>
<div style="background-color:limegreen;">886&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (m_offline) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>887&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return true;</div>
<div>888&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>889&emsp;&emsp;</div>
<div>890&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // now check for missing dependencies</div>
<div>891&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>892&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;Dependency> missing = toLoad.getMissingDependencies();</div>
<div style="background-color:limegreen;">893&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (missing.size() > 0) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div style="background-color:limegreen;">894&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>895&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          p.println("[WekaPackageManager] " + toLoad.getName()</div>
<div>896&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + " can't be loaded because the following"</div>
<div>897&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + " packages are missing:");</div>
<div style="background-color:limegreen;">898&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          for (Dependency d : missing) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>899&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            p.println(d.getTarget());</div>
<div>900&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>901&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>902&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return false;</div>
<div>903&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>904&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>905&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>906&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return false;</div>
<div>907&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>908&emsp;&emsp;</div>
<div>909&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // now check for buggered dependencies</div>
<div>910&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>911&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;Dependency> depends = toLoad.getDependencies();</div>
<div style="background-color:limegreen;">912&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (Dependency d : depends) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div style="background-color:limegreen;">913&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (d.getTarget().getPackage().isInstalled()) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div style="background-color:limegreen;">914&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          if (!loadCheck(d.getTarget().getPackage(), packageRoot, progress)) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>915&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            for (PrintStream p : progress) {</div>
<div>916&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              p.println("[WekaPackageManager] Can't load " + toLoad.getName() + " because "</div>
<div>917&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + d.getTarget() + " can't be loaded.");</div>
<div>918&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>919&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return false;</div>
<div>920&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>921&emsp;&emsp;</div>
<div>922&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // check that the version of installed dependency is OK</div>
<div>923&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Package installedD =</div>
<div>924&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            getInstalledPackageInfo(d.getTarget().getPackage().getName());</div>
<div>925&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (!d.getTarget().checkConstraint(installedD)) {</div>
<div>926&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            for (PrintStream p : progress) {</div>
<div>927&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              p.println("[WekaPackageManager] Can't load " + toLoad.getName()</div>
<div>928&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + " because the installed "</div>
<div>929&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + d.getTarget().getPackage().getName()</div>
<div>930&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + " is not compatible (requires: " + d.getTarget() + ")");</div>
<div>931&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>932&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return false;</div>
<div>933&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>934&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>935&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>936&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>937&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>938&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return false;</div>
<div>939&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>940&emsp;&emsp;</div>
<div>941&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return true;</div>
<div>942&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>943&emsp;&emsp;</div>
<div>944&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>945&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Checks to see if there are any missing files/directories for a given</div>
<div>946&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * package. If there are missing files, then the package can't be loaded. An</div>
<div>947&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * example would be a connector package that, for whatever reason, can't</div>
<div>948&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * include a necessary third-party jar file in its lib folder, and requires</div>
<div>949&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * the user to download and install this jar file manually.</div>
<div>950&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>951&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param toLoad the package to check</div>
<div>952&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageRoot the root directory of the package</div>
<div>953&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if good to go</div>
<div>954&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>955&emsp;&emsp;&nbsp;&nbsp;  public static boolean checkForMissingFiles(Package toLoad, File packageRoot,</div>
<div>956&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PrintStream... progress) {</div>
<div>957&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean result = true;</div>
<div>958&emsp;&emsp;</div>
<div>959&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Object doNotLoadIfFileMissing =</div>
<div>960&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      toLoad.getPackageMetaDataElement(DO_NOT_LOAD_IF_FILE_NOT_PRESENT_KEY);</div>
<div>961&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String packageRootPath = packageRoot.getPath() + File.separator;</div>
<div>962&emsp;&emsp;</div>
<div>963&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (doNotLoadIfFileMissing != null</div>
<div>964&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      && doNotLoadIfFileMissing.toString().length() > 0) {</div>
<div>965&emsp;&emsp;</div>
<div>966&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      StringTokenizer tok =</div>
<div>967&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new StringTokenizer(doNotLoadIfFileMissing.toString(), ",");</div>
<div>968&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      while (tok.hasMoreTokens()) {</div>
<div>969&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String nextT = tok.nextToken().trim();</div>
<div>970&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        File toCheck = new File(packageRootPath + nextT);</div>
<div>971&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (!toCheck.exists()) {</div>
<div>972&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          for (PrintStream p : progress) {</div>
<div>973&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            p.println("[WekaPackageManager] " + toLoad.getName()</div>
<div>974&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + " can't be loaded because " + toCheck.getPath()</div>
<div>975&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + " appears to be missing.");</div>
<div>976&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>977&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          result = false;</div>
<div>978&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          break;</div>
<div>979&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>980&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>981&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>982&emsp;&emsp;</div>
<div>983&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (!result) {</div>
<div>984&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // grab the message to print to the log (if any)</div>
<div>985&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Object doNotLoadMessage =</div>
<div>986&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        toLoad</div>
<div>987&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .getPackageMetaDataElement(DO_NOT_LOAD_IF_FILE_NOT_PRESENT_MESSAGE_KEY);</div>
<div>988&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (doNotLoadMessage != null && doNotLoadMessage.toString().length() > 0) {</div>
<div>989&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String dnlM = doNotLoadMessage.toString();</div>
<div>990&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        try {</div>
<div>991&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          dnlM = Environment.getSystemWide().substitute(dnlM);</div>
<div>992&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } catch (Exception ex) {</div>
<div>993&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // quietly ignore</div>
<div>994&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>995&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (PrintStream p : progress) {</div>
<div>996&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          p.println("[WekaPackageManager] " + dnlM);</div>
<div>997&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>998&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>999&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1000&emsp;&emsp;</div>
<div>1001&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return result;</div>
<div>1002&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1003&emsp;&emsp;</div>
<div>1004&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1005&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Reads the doNotLoad list (if it exists) from the packages directory</div>
<div>1006&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1007&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a set of package names that should not be loaded. This will be</div>
<div>1008&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *         empty if the doNotLoadList does not exist on disk.</div>
<div>1009&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1010&emsp;&emsp;&nbsp;&nbsp;  @SuppressWarnings("unchecked")</div>
<div>1011&emsp;&emsp;&nbsp;&nbsp;  protected static Set&#60;String> getDoNotLoadList() {</div>
<div>1012&emsp;&emsp;</div>
<div>1013&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Set&#60;String> doNotLoad = new HashSet&#60;String>();</div>
<div>1014&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File doNotLoadList =</div>
<div>1015&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      new File(PACKAGES_DIR.toString() + File.separator + "doNotLoad.ser");</div>
<div style="background-color:limegreen;">1016&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (doNotLoadList.exists() && doNotLoadList.isFile()) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>1017&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ObjectInputStream ois = null;</div>
<div>1018&emsp;&emsp;</div>
<div>1019&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>1020&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ois =</div>
<div>1021&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          new ObjectInputStream(new BufferedInputStream(new FileInputStream(</div>
<div>1022&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            doNotLoadList)));</div>
<div>1023&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        doNotLoad = (Set&#60;String>) ois.readObject();</div>
<div>1024&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (FileNotFoundException ex) {</div>
<div>1025&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (IOException e) {</div>
<div>1026&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err</div>
<div>1027&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .println("An error occurred while reading the doNotLoad list: "</div>
<div>1028&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + e.getMessage());</div>
<div>1029&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (ClassNotFoundException e) {</div>
<div>1030&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err</div>
<div>1031&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .println("An error occurred while reading the doNotLoad list: "</div>
<div>1032&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + e.getMessage());</div>
<div>1033&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } finally {</div>
<div style="background-color:limegreen;">1034&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (ois != null) {&nbsp;&#8594; [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR] & [PRUNE, CHECKERROR]</b></div>
<div>1035&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          try {</div>
<div>1036&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            ois.close();</div>
<div>1037&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          } catch (IOException ex) {</div>
<div>1038&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            ex.printStackTrace();</div>
<div>1039&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1040&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1041&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1042&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1043&emsp;&emsp;</div>
<div>1044&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return doNotLoad;</div>
<div>1045&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1046&emsp;&emsp;</div>
<div>1047&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1048&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Toggle the load status of the supplied list of package names</div>
<div>1049&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1050&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageNames the packages to toggle the load status for</div>
<div>1051&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a list of unknown packages (i.e. any supplied package names that</div>
<div>1052&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *         don't appear to be installed)</div>
<div>1053&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1054&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1055&emsp;&emsp;&nbsp;&nbsp;  public static List&#60;String> toggleLoadStatus(List&#60;String> packageNames)</div>
<div>1056&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>1057&emsp;&emsp;</div>
<div>1058&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;String> unknownPackages = new ArrayList&#60;String>();</div>
<div>1059&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean changeMade = false;</div>
<div>1060&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    for (String s : packageNames) {</div>
<div>1061&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Package p = PACKAGE_MANAGER.getInstalledPackageInfo(s);</div>
<div>1062&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (p == null) {</div>
<div>1063&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        unknownPackages.add(s);</div>
<div>1064&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>1065&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (m_doNotLoadList.contains(s)) {</div>
<div>1066&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          m_doNotLoadList.remove(s);</div>
<div>1067&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</div>
<div>1068&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // only mark as do not load if a package is loadable</div>
<div>1069&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (loadCheck(p, new File(WekaPackageManager.getPackageHome()</div>
<div>1070&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            .toString() + File.separator + s))) {</div>
<div>1071&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            m_doNotLoadList.add(s);</div>
<div>1072&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1073&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1074&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        changeMade = true;</div>
<div>1075&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1076&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1077&emsp;&emsp;</div>
<div>1078&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (changeMade) {</div>
<div>1079&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // write the list back to disk</div>
<div>1080&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      File doNotLoadList =</div>
<div>1081&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new File(PACKAGES_DIR.toString() + File.separator + "doNotLoad.ser");</div>
<div>1082&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ObjectOutputStream oos = null;</div>
<div>1083&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>1084&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        oos =</div>
<div>1085&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          new ObjectOutputStream(new BufferedOutputStream(new FileOutputStream(</div>
<div>1086&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            doNotLoadList)));</div>
<div>1087&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        oos.writeObject(m_doNotLoadList);</div>
<div>1088&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } finally {</div>
<div>1089&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (oos != null) {</div>
<div>1090&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          oos.flush();</div>
<div>1091&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          oos.close();</div>
<div>1092&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1093&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1094&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1095&emsp;&emsp;</div>
<div>1096&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return unknownPackages;</div>
<div>1097&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1098&emsp;&emsp;</div>
<div>1099&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1100&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Load all packages</div>
<div>1101&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1102&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param verbose true if loading progress should be output</div>
<div>1103&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1104&emsp;&emsp;&nbsp;&nbsp;  public static synchronized void loadPackages(boolean verbose) {</div>
<div>1105&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    loadPackages(verbose, false, true);</div>
<div>1106&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1107&emsp;&emsp;</div>
<div>1108&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1109&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Load all packages</div>
<div>1110&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1111&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param verbose true if loading progress should be output</div>
<div>1112&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param avoidTriggeringFullClassDiscovery true if we should avoid processing</div>
<div>1113&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          any properties files that might cause a full class discovery run,</div>
<div>1114&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          and may involve instantiating GUI classes.</div>
<div>1115&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param refreshGOEProperties true if the GOE properties should be refreshed</div>
<div>1116&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          after loading (i.e. a re-run of the class discovery mechanism,</div>
<div>1117&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          re-initialization of the Knowledge Flow etc.)</div>
<div>1118&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1119&emsp;&emsp;&nbsp;&nbsp;  public static synchronized void loadPackages(boolean verbose,</div>
<div>1120&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean avoidTriggeringFullClassDiscovery, boolean refreshGOEProperties) {</div>
<div>1121&emsp;&emsp;</div>
<div>1122&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;File> goePropsFiles = new ArrayList&#60;File>();</div>
<div style="background-color:limegreen;">1123&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!m_loadPackages) {&nbsp;&#8594; [OPTIMIZATIONS, NUMDECIMAL, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1124&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return;</div>
<div>1125&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1126&emsp;&emsp;</div>
<div style="background-color:limegreen;">1127&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (m_packagesLoaded) {&nbsp;&#8594; [OPTIMIZATIONS, NUMDECIMAL, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1128&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return;</div>
<div>1129&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1130&emsp;&emsp;</div>
<div>1131&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    m_packagesLoaded = true;</div>
<div>1132&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    m_initialPackageLoadingInProcess = true;</div>
<div style="background-color:limegreen;">1133&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (establishWekaHome()) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1134&emsp;&emsp;</div>
<div>1135&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // try and load any jar files and add to the classpath</div>
<div>1136&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      File[] contents = PACKAGES_DIR.listFiles();</div>
<div>1137&emsp;&emsp;</div>
<div>1138&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // if we have a non-empty packages dir then check</div>
<div>1139&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // the integrity of our cache first</div>
<div style="background-color:limegreen;">1140&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (contents.length > 0) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1141&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        establishCacheIfNeeded(System.out);</div>
<div>1142&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1143&emsp;&emsp;</div>
<div>1144&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // dynamic injection of dependencies between packages</div>
<div>1145&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Map&#60;String, List&#60;String>> injectDependencies = new HashMap&#60;>();</div>
<div>1146&emsp;&emsp;</div>
<div style="background-color:limegreen;">1147&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (File content : contents) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">1148&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (content.isDirectory()) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1149&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          try {</div>
<div>1150&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Package toLoad = getInstalledPackageInfo(content.getName());</div>
<div>1151&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            checkForInjectDependencies(toLoad, injectDependencies);</div>
<div>1152&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            boolean load;</div>
<div>1153&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // Only perform the check against the current version of Weka if</div>
<div>1154&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // there exists</div>
<div>1155&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // a Description.props file</div>
<div style="background-color:limegreen;">1156&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>            if (toLoad != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1157&emsp;&emsp;</div>
<div>1158&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              load = loadCheck(toLoad, content, System.err);</div>
<div>1159&emsp;&emsp;</div>
<div style="background-color:limegreen;">1160&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>              if (load) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">1161&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>                if (verbose) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1162&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  System.out.println("[WekaPackageManager] loading package "</div>
<div>1163&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    + content.getName());</div>
<div>1164&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                }</div>
<div>1165&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                WekaPackageClassLoaderManager</div>
<div>1166&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  .getWekaPackageClassLoaderManager().addPackageToClassLoader(</div>
<div>1167&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    content);</div>
<div>1168&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              }</div>
<div>1169&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>1170&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          } catch (Exception ex) {</div>
<div>1171&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            ex.printStackTrace();</div>
<div>1172&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            System.err.println("[WekaPackageManager] Problem loading package "</div>
<div>1173&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + content.getName() + " skipping...");</div>
<div>1174&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1175&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1176&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1177&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // now inject any package dependencies</div>
<div>1178&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      injectPackageDependencies(injectDependencies);</div>
<div>1179&emsp;&emsp;</div>
<div>1180&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // now check overall integrity</div>
<div>1181&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>1182&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        .performIntegrityCheck();</div>
<div>1183&emsp;&emsp;</div>
<div>1184&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // now process the various properties files in the packages</div>
<div style="background-color:limegreen;">1185&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (File content : contents) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1186&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        try {</div>
<div style="background-color:limegreen;">1187&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          if (content.isDirectory()&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1188&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            && WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div style="background-color:limegreen;">1189&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>              .getPackageClassLoader(content.getName()) != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1190&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            processPackageDirectory(content, verbose, goePropsFiles,</div>
<div>1191&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              avoidTriggeringFullClassDiscovery);</div>
<div>1192&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1193&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } catch (Exception ex) {</div>
<div>1194&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          ex.printStackTrace();</div>
<div>1195&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.err.println("[WekaPackageManager] Problem loading package "</div>
<div>1196&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + content.getName() + " skipping...");</div>
<div>1197&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1198&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1199&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1200&emsp;&emsp;</div>
<div>1201&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    m_initialPackageLoadingInProcess = false;</div>
<div>1202&emsp;&emsp;</div>
<div>1203&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // it is best to process all of these after all jars have been</div>
<div>1204&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // inserted into the classpath since the dynamic class discovery</div>
<div>1205&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // mechanism will load classes during the process of determining</div>
<div>1206&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // all implementations of base types, and this can cause problems</div>
<div>1207&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // if processed at the time of package loading and there are</div>
<div>1208&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // dependencies between packages</div>
<div style="background-color:limegreen;">1209&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!avoidTriggeringFullClassDiscovery) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">1210&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (File f : goePropsFiles) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1211&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        processGenericPropertiesCreatorProps(f);</div>
<div>1212&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1213&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1214&emsp;&emsp;</div>
<div>1215&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // do we need to regenerate the list of available schemes for</div>
<div>1216&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // the GUIs (this is not necessary when executing stuff from</div>
<div>1217&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // the command line)</div>
<div style="background-color:limegreen;">1218&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (refreshGOEProperties) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">1219&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (verbose) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1220&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Refreshing GOE props...");</div>
<div>1221&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1222&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      refreshGOEProperties();</div>
<div>1223&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1224&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1225&emsp;&emsp;</div>
<div>1226&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1227&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Checks a package for the presence of any specified package dependencies to</div>
<div>1228&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * inject at load time</div>
<div>1229&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1230&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param toLoad the package to check</div>
<div>1231&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param injectDeps a map (keyed by source package name) containing lists of</div>
<div>1232&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          target packages. Each source package will have the entries in its</div>
<div>1233&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          target package list injected (via the WekaLibIsolatingClassLoader)</div>
<div>1234&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          as dependencies.</div>
<div>1235&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1236&emsp;&emsp;&nbsp;&nbsp;  protected static void checkForInjectDependencies(Package toLoad,</div>
<div>1237&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, List&#60;String>> injectDeps) {</div>
<div>1238&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Object injectList = toLoad.getPackageMetaDataElement(INJECT_DEPENDENCY_KEY);</div>
<div style="background-color:limegreen;">1239&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (injectList != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1240&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String[] deps = injectList.toString().split(",");</div>
<div style="background-color:limegreen;">1241&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (String dep : deps) {&nbsp;&#8594; [PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1242&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String[] sourceAndTarget = dep.split(":");</div>
<div style="background-color:limegreen;">1243&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (sourceAndTarget.length == 2) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1244&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String depender = sourceAndTarget[0].trim();</div>
<div>1245&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String dependee = sourceAndTarget[1].trim();</div>
<div>1246&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          List&#60;String> depList = injectDeps.get(depender);</div>
<div style="background-color:limegreen;">1247&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          if (depList == null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>1248&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            depList = new ArrayList&#60;>();</div>
<div>1249&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            injectDeps.put(depender, depList);</div>
<div>1250&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1251&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          depList.add(dependee);</div>
<div>1252&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1253&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1254&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1255&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1256&emsp;&emsp;</div>
<div>1257&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1258&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Processes a map of dependencies to inject. Each source package (key) will</div>
<div>1259&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * have the packages named in the associated list (value) injected as</div>
<div>1260&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * dependencies at load time.</div>
<div>1261&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1262&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param injectDependencies a map of source to target dependencies.</div>
<div>1263&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1264&emsp;&emsp;&nbsp;&nbsp;  protected static void injectPackageDependencies(</div>
<div>1265&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, List&#60;String>> injectDependencies) {</div>
<div style="background-color:limegreen;">1266&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    for (Map.Entry&#60;String, List&#60;String>> e : injectDependencies.entrySet()) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1267&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String source = e.getKey();</div>
<div>1268&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;String> targets = e.getValue();</div>
<div>1269&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      WekaPackageLibIsolatingClassLoader sourceLoader =</div>
<div>1270&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>1271&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .getPackageClassLoader(source);</div>
<div style="background-color:limegreen;">1272&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (sourceLoader != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">1273&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        for (String targetPackage : targets) {&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1274&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div style="background-color:limegreen;">1275&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>            .getPackageClassLoader(targetPackage) != null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1276&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            System.out</div>
<div>1277&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              .println("[WekaPackageManager] Added a dependency between "</div>
<div>1278&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + source + " and " + targetPackage);</div>
<div>1279&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            sourceLoader.addPackageDependency(targetPackage);</div>
<div>1280&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1281&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1282&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1283&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1284&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1285&emsp;&emsp;</div>
<div>1286&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1287&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Refresh the generic object editor properties via re-running of the dynamic</div>
<div>1288&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * class discovery process.</div>
<div>1289&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1290&emsp;&emsp;&nbsp;&nbsp;  public static void refreshGOEProperties() {</div>
<div>1291&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    ClassDiscovery.clearClassCache();</div>
<div>1292&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    GenericPropertiesCreator.regenerateGlobalOutputProperties();</div>
<div>1293&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    GenericObjectEditor.determineClasses();</div>
<div>1294&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    ConverterUtils.initialize();</div>
<div>1295&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    KnowledgeFlowApp.disposeSingleton();</div>
<div>1296&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    KnowledgeFlowApp.reInitialize();</div>
<div>1297&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1298&emsp;&emsp;</div>
<div>1299&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1300&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get the underlying package manager implementation</div>
<div>1301&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1302&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the underlying concrete package management implementation.</div>
<div>1303&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1304&emsp;&emsp;&nbsp;&nbsp;  public static PackageManager getUnderlyingPackageManager() {</div>
<div>1305&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER;</div>
<div>1306&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1307&emsp;&emsp;</div>
<div>1308&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1309&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Retrieves the size (in KB) of the repository zip archive stored on the</div>
<div>1310&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * server.</div>
<div>1311&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1312&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the size of the repository zip archive in KB.</div>
<div>1313&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1314&emsp;&emsp;&nbsp;&nbsp;  public static int repoZipArchiveSize() {</div>
<div>1315&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    int size = -1;</div>
<div>1316&emsp;&emsp;</div>
<div>1317&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>1318&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>1319&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String numPackagesS =</div>
<div>1320&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.getPackageRepositoryURL().toString() + "/repoSize.txt";</div>
<div>1321&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URLConnection conn = null;</div>
<div>1322&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URL connURL = new URL(numPackagesS);</div>
<div>1323&emsp;&emsp;</div>
<div>1324&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (PACKAGE_MANAGER.setProxyAuthentication(connURL)) {</div>
<div>1325&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection(PACKAGE_MANAGER.getProxy());</div>
<div>1326&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>1327&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection();</div>
<div>1328&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1329&emsp;&emsp;</div>
<div>1330&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      conn.setConnectTimeout(30000); // timeout after 30 seconds</div>
<div>1331&emsp;&emsp;</div>
<div>1332&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedReader bi =</div>
<div>1333&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedReader(new InputStreamReader(conn.getInputStream()));</div>
<div>1334&emsp;&emsp;</div>
<div>1335&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String n = bi.readLine();</div>
<div>1336&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>1337&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        size = Integer.parseInt(n);</div>
<div>1338&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (NumberFormatException ne) {</div>
<div>1339&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("[WekaPackageManager] problem parsing the size "</div>
<div>1340&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "of repository zip archive from the server.");</div>
<div>1341&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1342&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div>1343&emsp;&emsp;</div>
<div>1344&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>1345&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>1346&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1347&emsp;&emsp;</div>
<div>1348&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return size;</div>
<div>1349&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1350&emsp;&emsp;</div>
<div>1351&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1352&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get the number of packages that are available at the repository.</div>
<div>1353&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1354&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the number of packages that are available (or -1 if this can't be</div>
<div>1355&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *         determined for some reason.</div>
<div>1356&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1357&emsp;&emsp;&nbsp;&nbsp;  public static int numRepositoryPackages() {</div>
<div>1358&emsp;&emsp;</div>
<div>1359&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (m_offline) {</div>
<div>1360&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return -1;</div>
<div>1361&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1362&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    int numPackages = -1;</div>
<div>1363&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>1364&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>1365&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String numPackagesS =</div>
<div>1366&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.getPackageRepositoryURL().toString()</div>
<div>1367&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "/numPackages.txt";</div>
<div>1368&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URLConnection conn = null;</div>
<div>1369&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URL connURL = new URL(numPackagesS);</div>
<div>1370&emsp;&emsp;</div>
<div>1371&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (PACKAGE_MANAGER.setProxyAuthentication(connURL)) {</div>
<div>1372&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection(PACKAGE_MANAGER.getProxy());</div>
<div>1373&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>1374&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection();</div>
<div>1375&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1376&emsp;&emsp;</div>
<div>1377&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      conn.setConnectTimeout(30000); // timeout after 30 seconds</div>
<div>1378&emsp;&emsp;</div>
<div>1379&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedReader bi =</div>
<div>1380&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedReader(new InputStreamReader(conn.getInputStream()));</div>
<div>1381&emsp;&emsp;</div>
<div>1382&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String n = bi.readLine();</div>
<div>1383&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>1384&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        numPackages = Integer.parseInt(n);</div>
<div>1385&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (NumberFormatException ne) {</div>
<div>1386&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("[WekaPackageManager] problem parsing number "</div>
<div>1387&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "of packages from server.");</div>
<div>1388&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1389&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div>1390&emsp;&emsp;</div>
<div>1391&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>1392&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>1393&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1394&emsp;&emsp;</div>
<div>1395&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return numPackages;</div>
<div>1396&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1397&emsp;&emsp;</div>
<div>1398&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1399&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Just get a list of the package names. This is faster than calling</div>
<div>1400&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * getAllPackages(), especially if fetching from the online repository, since</div>
<div>1401&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * the full meta data for each package doesn't have to be read.</div>
<div>1402&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1403&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param local true if the local package list in the cache should be read</div>
<div>1404&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          rather than the online repository</div>
<div>1405&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1406&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a Map&#60;String, String> of all the package names available either</div>
<div>1407&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *         locally or at the repository</div>
<div>1408&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1409&emsp;&emsp;&nbsp;&nbsp;  public static Map&#60;String, String> getPackageList(boolean local) {</div>
<div>1410&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, String> result = new HashMap&#60;String, String>();</div>
<div>1411&emsp;&emsp;</div>
<div>1412&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>1413&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      useCacheOrOnlineRepository();</div>
<div>1414&emsp;&emsp;</div>
<div>1415&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (!local) {</div>
<div>1416&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>1417&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1418&emsp;&emsp;</div>
<div>1419&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String packageListS =</div>
<div>1420&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.getPackageRepositoryURL().toString() + "/"</div>
<div>1421&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + PACKAGE_LIST_WITH_VERSION_FILE;</div>
<div>1422&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URLConnection conn = null;</div>
<div>1423&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      URL connURL = new URL(packageListS);</div>
<div>1424&emsp;&emsp;</div>
<div>1425&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (PACKAGE_MANAGER.setProxyAuthentication(connURL)) {</div>
<div>1426&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection(PACKAGE_MANAGER.getProxy());</div>
<div>1427&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>1428&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection();</div>
<div>1429&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1430&emsp;&emsp;</div>
<div>1431&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      conn.setConnectTimeout(30000); // timeout after 30 seconds</div>
<div>1432&emsp;&emsp;</div>
<div>1433&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedReader bi =</div>
<div>1434&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedReader(new InputStreamReader(conn.getInputStream()));</div>
<div>1435&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String l = null;</div>
<div>1436&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      while ((l = bi.readLine()) != null) {</div>
<div>1437&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String[] parts = l.split(":");</div>
<div>1438&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (parts.length == 2) {</div>
<div>1439&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          result.put(parts[0], parts[1]);</div>
<div>1440&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1441&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1442&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      bi.close();</div>
<div>1443&emsp;&emsp;</div>
<div>1444&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>1445&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // ex.printStackTrace();</div>
<div>1446&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      result = null;</div>
<div>1447&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1448&emsp;&emsp;</div>
<div>1449&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return result;</div>
<div>1450&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1451&emsp;&emsp;</div>
<div>1452&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1453&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Establish the local copy of the package meta data if needed</div>
<div>1454&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1455&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress for reporting progress</div>
<div>1456&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return any Exception raised or null if all is good</div>
<div>1457&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1458&emsp;&emsp;&nbsp;&nbsp;  public static Exception establishCacheIfNeeded(PrintStream... progress) {</div>
<div style="background-color:limegreen;">1459&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (m_offline) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1460&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return null;</div>
<div>1461&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1462&emsp;&emsp;</div>
<div style="background-color:limegreen;">1463&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (REP_MIRROR == null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1464&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      establishMirror();</div>
<div>1465&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1466&emsp;&emsp;</div>
<div>1467&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Exception problem = null;</div>
<div style="background-color:limegreen;">1468&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (INITIAL_CACHE_BUILD_NEEDED) {&nbsp;&#8594; [PRUNE, CHECKERROR, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">1469&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1470&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        p.println("Caching repository metadata, please wait...");</div>
<div>1471&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1472&emsp;&emsp;</div>
<div>1473&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      problem = refreshCache(progress);</div>
<div>1474&emsp;&emsp;</div>
<div>1475&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      INITIAL_CACHE_BUILD_NEEDED = false;</div>
<div>1476&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } else {</div>
<div>1477&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // if no initial build needed then check for a server-side forced</div>
<div>1478&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // refresh...</div>
<div>1479&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div style="background-color:limegreen;">1480&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>        if (checkForForcedCacheRefresh()) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div style="background-color:limegreen;">1481&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>          for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1482&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            p.println("Forced repository metadata refresh, please wait...");</div>
<div>1483&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1484&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          problem = refreshCache(progress);</div>
<div>1485&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1486&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (MalformedURLException ex) {</div>
<div>1487&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        problem = ex;</div>
<div>1488&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1489&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1490&emsp;&emsp;</div>
<div>1491&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return problem;</div>
<div>1492&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1493&emsp;&emsp;</div>
<div>1494&emsp;&emsp;&nbsp;&nbsp;  protected static boolean checkForForcedCacheRefresh()</div>
<div>1495&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws MalformedURLException {</div>
<div>1496&emsp;&emsp;</div>
<div>1497&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    int refreshCountServer = getForcedRefreshCount(false);</div>
<div style="background-color:limegreen;">1498&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (refreshCountServer > 0) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1499&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // now check local version of this file...</div>
<div>1500&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      int refreshCountLocal = getForcedRefreshCount(true);</div>
<div style="background-color:limegreen;">1501&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      return refreshCountServer > refreshCountLocal;&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1502&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1503&emsp;&emsp;</div>
<div>1504&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return false;</div>
<div>1505&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1506&emsp;&emsp;</div>
<div>1507&emsp;&emsp;&nbsp;&nbsp;  protected static int getForcedRefreshCount(boolean local)</div>
<div>1508&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws MalformedURLException {</div>
<div>1509&emsp;&emsp;</div>
<div>1510&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div style="background-color:limegreen;">1511&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (!local) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1512&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>1513&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1514&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String refreshCountS =</div>
<div>1515&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.getPackageRepositoryURL().toString() + "/"</div>
<div>1516&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + FORCED_REFRESH_COUNT_FILE;</div>
<div>1517&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    int refreshCount = -1;</div>
<div>1518&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    URLConnection conn = null;</div>
<div>1519&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    URL connURL = new URL(refreshCountS);</div>
<div>1520&emsp;&emsp;</div>
<div>1521&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div style="background-color:limegreen;">1522&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      if (PACKAGE_MANAGER.setProxyAuthentication(connURL)) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>1523&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection(PACKAGE_MANAGER.getProxy());</div>
<div>1524&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>1525&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        conn = connURL.openConnection();</div>
<div>1526&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1527&emsp;&emsp;</div>
<div>1528&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      conn.setConnectTimeout(30000); // timeout after 30 seconds</div>
<div>1529&emsp;&emsp;</div>
<div>1530&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      BufferedReader bi =</div>
<div>1531&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new BufferedReader(new InputStreamReader(conn.getInputStream()));</div>
<div>1532&emsp;&emsp;</div>
<div>1533&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String countS = bi.readLine();</div>
<div>1534&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (countS != null && countS.length() > 0) {</div>
<div>1535&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        try {</div>
<div>1536&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          refreshCount = Integer.parseInt(countS);</div>
<div>1537&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } catch (NumberFormatException ne) {</div>
<div>1538&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // ignore</div>
<div>1539&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1540&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1541&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (IOException ex) {</div>
<div>1542&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // ignore</div>
<div>1543&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1544&emsp;&emsp;</div>
<div>1545&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return refreshCount;</div>
<div>1546&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1547&emsp;&emsp;</div>
<div>1548&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1549&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Check for new packages on the server and refresh the local cache if needed</div>
<div>1550&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1551&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress to report progress to</div>
<div>1552&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return any Exception raised or null if all is good</div>
<div>1553&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1554&emsp;&emsp;&nbsp;&nbsp;  public static Exception checkForNewPackages(PrintStream... progress) {</div>
<div>1555&emsp;&emsp;</div>
<div>1556&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (m_offline) {</div>
<div>1557&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return null;</div>
<div>1558&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1559&emsp;&emsp;</div>
<div>1560&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Exception problem = null;</div>
<div>1561&emsp;&emsp;</div>
<div>1562&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, String> localPackageNameList = getPackageList(true);</div>
<div>1563&emsp;&emsp;</div>
<div>1564&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (localPackageNameList == null) {</div>
<div>1565&emsp;&emsp;</div>
<div>1566&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.err.println("Local package list is missing, trying a "</div>
<div>1567&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "cache refresh to restore...");</div>
<div>1568&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      refreshCache(progress);</div>
<div>1569&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      localPackageNameList = getPackageList(true);</div>
<div>1570&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (localPackageNameList == null) {</div>
<div>1571&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // quietly return and see if we can continue anyway</div>
<div>1572&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return null;</div>
<div>1573&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1574&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1575&emsp;&emsp;</div>
<div>1576&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, String> repositoryPackageNameList = getPackageList(false);</div>
<div>1577&emsp;&emsp;</div>
<div>1578&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (repositoryPackageNameList == null) {</div>
<div>1579&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // quietly return and see if we can continue anyway</div>
<div>1580&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return null;</div>
<div>1581&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1582&emsp;&emsp;</div>
<div>1583&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (repositoryPackageNameList.keySet().size() != localPackageNameList</div>
<div>1584&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .keySet().size()) {</div>
<div>1585&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // package(s) have disappeared from the repository.</div>
<div>1586&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // Force a cache refresh...</div>
<div>1587&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (repositoryPackageNameList.keySet().size() &#60; localPackageNameList</div>
<div>1588&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        .keySet().size()) {</div>
<div>1589&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (PrintStream p : progress) {</div>
<div>1590&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          p.println("Some packages no longer exist at the repository. "</div>
<div>1591&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + "Refreshing cache...");</div>
<div>1592&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1593&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>1594&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (PrintStream p : progress) {</div>
<div>1595&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          p.println("There are new packages at the repository. "</div>
<div>1596&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + "Refreshing cache...");</div>
<div>1597&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1598&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1599&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      problem = refreshCache(progress);</div>
<div>1600&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } else {</div>
<div>1601&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // check for new versions of packages</div>
<div>1602&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      boolean refresh = false;</div>
<div>1603&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (String localPackage : localPackageNameList.keySet()) {</div>
<div>1604&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String localVersion = localPackageNameList.get(localPackage);</div>
<div>1605&emsp;&emsp;</div>
<div>1606&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String repoVersion = repositoryPackageNameList.get(localPackage);</div>
<div>1607&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (repoVersion == null) {</div>
<div>1608&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          continue;</div>
<div>1609&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1610&emsp;&emsp;</div>
<div>1611&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // a difference here indicates a newer version on the server</div>
<div>1612&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (!localVersion.equals(repoVersion)) {</div>
<div>1613&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          refresh = true;</div>
<div>1614&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          break;</div>
<div>1615&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1616&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1617&emsp;&emsp;</div>
<div>1618&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (refresh) {</div>
<div>1619&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (PrintStream p : progress) {</div>
<div>1620&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          p.println("There are newer versions of existing packages "</div>
<div>1621&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + "at the repository. Refreshing cache...");</div>
<div>1622&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1623&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        problem = refreshCache(progress);</div>
<div>1624&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1625&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1626&emsp;&emsp;</div>
<div>1627&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return problem;</div>
<div>1628&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1629&emsp;&emsp;</div>
<div>1630&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1631&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Deletes the contents of $WEKA_HOME/repCache</div>
<div>1632&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1633&emsp;&emsp;&nbsp;&nbsp;  protected static void cleanRepCacheDir() {</div>
<div>1634&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String cacheDir = WEKA_HOME.toString() + File.separator + "repCache";</div>
<div>1635&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File cacheDirF = new File(cacheDir);</div>
<div>1636&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (cacheDirF.exists()) {</div>
<div>1637&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      File[] contents = cacheDirF.listFiles();</div>
<div>1638&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (contents != null) {</div>
<div>1639&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (File f : contents) {</div>
<div>1640&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (f.isDirectory()) {</div>
<div>1641&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            File[] packageMetaDirContents = f.listFiles();</div>
<div>1642&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (packageMetaDirContents != null) {</div>
<div>1643&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              for (File pf : packageMetaDirContents) {</div>
<div>1644&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                pf.delete();</div>
<div>1645&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              }</div>
<div>1646&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>1647&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1648&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          f.delete();</div>
<div>1649&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1650&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1651&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1652&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1653&emsp;&emsp;</div>
<div>1654&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1655&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Refresh the local copy of the package meta data</div>
<div>1656&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1657&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress to report progress to</div>
<div>1658&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return any Exception raised or null if all is successful</div>
<div>1659&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1660&emsp;&emsp;&nbsp;&nbsp;  public static Exception refreshCache(PrintStream... progress) {</div>
<div>1661&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Exception problem = null;</div>
<div style="background-color:limegreen;">1662&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (CACHE_URL == null) {&nbsp;&#8594; [PRUNE, CHECKERROR, FOLDS]</b></div>
<div>1663&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return null;</div>
<div>1664&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1665&emsp;&emsp;</div>
<div>1666&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>1667&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String cacheDir = WEKA_HOME.toString() + File.separator + "repCache";</div>
<div>1668&emsp;&emsp;</div>
<div>1669&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div style="background-color:limegreen;">1670&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>      for (PrintStream p : progress) {&nbsp;&#8594; [PRUNE, CHECKERROR]</b></div>
<div>1671&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        p.println("Refresh in progress. Please wait...");</div>
<div>1672&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1673&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      byte[] zip =</div>
<div>1674&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.getRepositoryPackageMetaDataOnlyAsZip(progress);</div>
<div>1675&emsp;&emsp;</div>
<div>1676&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // only blow away the repCache if we successfully get a new zip!</div>
<div>1677&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      cleanRepCacheDir();</div>
<div>1678&emsp;&emsp;</div>
<div>1679&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ZipInputStream zis = new ZipInputStream(new ByteArrayInputStream(zip));</div>
<div>1680&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ZipEntry ze;</div>
<div>1681&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      final byte[] buff = new byte[1024];</div>
<div>1682&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      while ((ze = zis.getNextEntry()) != null) {</div>
<div>1683&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // System.out.println("Cache: inflating " + ze.getName());</div>
<div>1684&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (ze.isDirectory()) {</div>
<div>1685&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          new File(cacheDir, ze.getName()).mkdir();</div>
<div>1686&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          continue;</div>
<div>1687&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1688&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        BufferedOutputStream bo =</div>
<div>1689&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          new BufferedOutputStream(new FileOutputStream(new File(cacheDir,</div>
<div>1690&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            ze.getName())));</div>
<div>1691&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        while (true) {</div>
<div>1692&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          int amountRead = zis.read(buff);</div>
<div>1693&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (amountRead == -1) {</div>
<div>1694&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            break;</div>
<div>1695&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1696&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // write the data here</div>
<div>1697&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          bo.write(buff, 0, amountRead);</div>
<div>1698&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1699&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        bo.close();</div>
<div>1700&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1701&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception e) {</div>
<div>1702&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      e.printStackTrace();</div>
<div>1703&emsp;&emsp;</div>
<div>1704&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // OK, we have a problem with the repository cache - use</div>
<div>1705&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // the repository itself instead and delete repCache</div>
<div>1706&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      CACHE_URL = null;</div>
<div>1707&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>1708&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        DefaultPackageManager.deleteDir(new File(cacheDir), System.out);</div>
<div>1709&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (Exception e1) {</div>
<div>1710&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        e1.printStackTrace();</div>
<div>1711&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1712&emsp;&emsp;</div>
<div>1713&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return e;</div>
<div>1714&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1715&emsp;&emsp;</div>
<div>1716&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return problem;</div>
<div>1717&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1718&emsp;&emsp;</div>
<div>1719&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1720&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Check if a named resource exists in an installed package</div>
<div>1721&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1722&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package in question</div>
<div>1723&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param resourceName the name of the resource to check for</div>
<div>1724&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if the resource exists in the package</div>
<div>1725&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1726&emsp;&emsp;&nbsp;&nbsp;  public static boolean installedPackageResourceExists(String packageName,</div>
<div>1727&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String resourceName) {</div>
<div>1728&emsp;&emsp;</div>
<div>1729&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String fullResourcePath =</div>
<div>1730&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      getPackageHome().toString() + File.separator + packageName</div>
<div>1731&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + File.separator + resourceName;</div>
<div>1732&emsp;&emsp;</div>
<div>1733&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return new File(fullResourcePath).exists();</div>
<div>1734&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1735&emsp;&emsp;</div>
<div>1736&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1737&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Determines whether to use the local cache or online repository for meta</div>
<div>1738&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * data</div>
<div>1739&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1740&emsp;&emsp;&nbsp;&nbsp;  private static void useCacheOrOnlineRepository() {</div>
<div style="background-color:limegreen;">1741&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (REP_MIRROR == null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, SEED, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1742&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      establishMirror();</div>
<div>1743&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1744&emsp;&emsp;</div>
<div style="background-color:limegreen;">1745&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    if (CACHE_URL != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1746&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.setPackageRepositoryURL(CACHE_URL);</div>
<div style="background-color:limegreen;">1747&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>    } else if (REP_URL != null) {&nbsp;&#8594; [OPTIMIZATIONS, PRUNE, CHECKERROR, MINNO, DEBUG, FOLDS, NOCHECKCAPABILITIES]</b></div>
<div>1748&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.setPackageRepositoryURL(REP_URL);</div>
<div>1749&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1750&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1751&emsp;&emsp;</div>
<div>1752&emsp;&emsp;&nbsp;&nbsp;  public static File getPackageHome() {</div>
<div>1753&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getPackageHome();</div>
<div>1754&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1755&emsp;&emsp;</div>
<div>1756&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1757&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Find the most recent version of the package encapsulated in the supplied</div>
<div>1758&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * PackageConstraint argument that satisfies the constraint</div>
<div>1759&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1760&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param toCheck the PackageConstraint containing the package in question</div>
<div>1761&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the most recent version of the package satisfying the constraint</div>
<div>1762&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a version can't be found that satisfies the constraint</div>
<div>1763&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *           or an error occurs while communicating with the respository</div>
<div>1764&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1765&emsp;&emsp;&nbsp;&nbsp;  public static Package mostRecentVersionWithRespectToConstraint(</div>
<div>1766&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PackageConstraint toCheck) throws Exception {</div>
<div>1767&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package target = toCheck.getPackage();</div>
<div>1768&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package result = null;</div>
<div>1769&emsp;&emsp;</div>
<div>1770&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Object> availableVersions =</div>
<div>1771&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.getRepositoryPackageVersions(target.getName());</div>
<div>1772&emsp;&emsp;</div>
<div>1773&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // version numbers will be in descending sorted order from the repository</div>
<div>1774&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // we want the most recent version that meets the target constraint</div>
<div>1775&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    for (Object version : availableVersions) {</div>
<div>1776&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Package candidate =</div>
<div>1777&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.getRepositoryPackageInfo(target.getName(), version);</div>
<div>1778&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (toCheck.checkConstraint(candidate)</div>
<div>1779&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        && candidate.isCompatibleBaseSystem()) {</div>
<div>1780&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        result = candidate;</div>
<div>1781&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        break;</div>
<div>1782&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1783&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1784&emsp;&emsp;</div>
<div>1785&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (result == null) {</div>
<div>1786&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      throw new Exception("[WekaPackageManager] unable to find a version of "</div>
<div>1787&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "package " + target.getName() + " that meets constraint "</div>
<div>1788&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + toCheck.toString());</div>
<div>1789&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1790&emsp;&emsp;</div>
<div>1791&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return result;</div>
<div>1792&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1793&emsp;&emsp;</div>
<div>1794&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1795&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Install the supplied list of packages</div>
<div>1796&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1797&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param toInstall packages to install</div>
<div>1798&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress to report progress to</div>
<div>1799&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if successful</div>
<div>1800&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1801&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1802&emsp;&emsp;&nbsp;&nbsp;  public static boolean installPackages(List&#60;Package> toInstall,</div>
<div>1803&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PrintStream... progress) throws Exception {</div>
<div>1804&emsp;&emsp;</div>
<div>1805&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>1806&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Boolean> upgrades = new ArrayList&#60;Boolean>();</div>
<div>1807&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    for (Package p : toInstall) {</div>
<div>1808&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (p.isInstalled()) {</div>
<div>1809&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        upgrades.add(new Boolean(true));</div>
<div>1810&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>1811&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        upgrades.add(new Boolean(false));</div>
<div>1812&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1813&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1814&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.installPackages(toInstall, progress);</div>
<div>1815&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean atLeastOneUpgrade = false;</div>
<div>1816&emsp;&emsp;</div>
<div>1817&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;File> gpcFiles = new ArrayList&#60;File>();</div>
<div>1818&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    int i = 0;</div>
<div>1819&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, List&#60;String>> injectDependencies = new HashMap&#60;>();</div>
<div>1820&emsp;&emsp;</div>
<div>1821&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    for (Package p : toInstall) {</div>
<div>1822&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      boolean isAnUpgrade = upgrades.get(i++);</div>
<div>1823&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (isAnUpgrade) {</div>
<div>1824&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        atLeastOneUpgrade = true;</div>
<div>1825&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1826&emsp;&emsp;</div>
<div>1827&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String packageName = p.getName();</div>
<div>1828&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      File packageDir =</div>
<div>1829&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new File(PACKAGE_MANAGER.getPackageHome().toString() + File.separator</div>
<div>1830&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + packageName);</div>
<div>1831&emsp;&emsp;</div>
<div>1832&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      checkForInjectDependencies(p, injectDependencies);</div>
<div>1833&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      boolean loadIt = loadCheck(p, packageDir, progress);</div>
<div>1834&emsp;&emsp;</div>
<div>1835&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (loadIt & !isAnUpgrade) {</div>
<div>1836&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        processPackageDirectory(packageDir, false, gpcFiles, false);</div>
<div>1837&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1838&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1839&emsp;&emsp;</div>
<div>1840&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // inject dependencies before triggering any class discovery</div>
<div>1841&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    injectPackageDependencies(injectDependencies);</div>
<div>1842&emsp;&emsp;</div>
<div>1843&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>1844&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .performIntegrityCheck();</div>
<div>1845&emsp;&emsp;</div>
<div>1846&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    for (File f : gpcFiles) {</div>
<div>1847&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      processGenericPropertiesCreatorProps(f);</div>
<div>1848&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1849&emsp;&emsp;</div>
<div>1850&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return atLeastOneUpgrade;</div>
<div>1851&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1852&emsp;&emsp;</div>
<div>1853&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1854&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get the versions of the supplied package available on the server</div>
<div>1855&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1856&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the package name to get available versions for</div>
<div>1857&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a list of available versions</div>
<div>1858&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1859&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1860&emsp;&emsp;&nbsp;&nbsp;  public static List&#60;Object> getRepositoryPackageVersions(String packageName)</div>
<div>1861&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>1862&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>1863&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getRepositoryPackageVersions(packageName);</div>
<div>1864&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1865&emsp;&emsp;</div>
<div>1866&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1867&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get the package repository URL</div>
<div>1868&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1869&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the package repository URL</div>
<div>1870&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1871&emsp;&emsp;&nbsp;&nbsp;  public static URL getPackageRepositoryURL() {</div>
<div>1872&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>1873&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getPackageRepositoryURL();</div>
<div>1874&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1875&emsp;&emsp;</div>
<div>1876&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1877&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get a list of all packages</div>
<div>1878&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1879&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a list of all packages</div>
<div>1880&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1881&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1882&emsp;&emsp;&nbsp;&nbsp;  public static List&#60;Package> getAllPackages() throws Exception {</div>
<div>1883&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>1884&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getAllPackages();</div>
<div>1885&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1886&emsp;&emsp;</div>
<div>1887&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1888&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get a list of all available packages (i.e. those not yet installed(.</div>
<div>1889&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1890&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a list of all available packages</div>
<div>1891&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1892&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1893&emsp;&emsp;&nbsp;&nbsp;  public static List&#60;Package> getAvailablePackages() throws Exception {</div>
<div>1894&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>1895&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getAvailablePackages();</div>
<div>1896&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1897&emsp;&emsp;</div>
<div>1898&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1899&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get a list of the most recent version of all available packages (i.e. those</div>
<div>1900&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * not yet installed or there is a higher version in the repository) that are</div>
<div>1901&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * compatible with the version of Weka that is installed.</div>
<div>1902&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1903&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a list of packages that are compatible with the installed version</div>
<div>1904&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *         of Weka</div>
<div>1905&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1906&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1907&emsp;&emsp;&nbsp;&nbsp;  public static List&#60;Package> getAvailableCompatiblePackages() throws Exception {</div>
<div>1908&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // List&#60;Package> allAvail = getAvailablePackages();</div>
<div>1909&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Package> allAvail = getAllPackages();</div>
<div>1910&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Package> compatible = new ArrayList&#60;Package>();</div>
<div>1911&emsp;&emsp;</div>
<div>1912&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    for (Package p : allAvail) {</div>
<div>1913&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;Object> availableVersions =</div>
<div>1914&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.getRepositoryPackageVersions(p.getName());</div>
<div>1915&emsp;&emsp;</div>
<div>1916&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // version numbers will be in descending sorted order from the repository</div>
<div>1917&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // we want the most recent version that is compatible with the base weka</div>
<div>1918&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // version</div>
<div>1919&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (Object version : availableVersions) {</div>
<div>1920&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Package versionedPackage =</div>
<div>1921&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          getRepositoryPackageInfo(p.getName(), version.toString());</div>
<div>1922&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (versionedPackage.isCompatibleBaseSystem()) {</div>
<div>1923&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (p.isInstalled()) {</div>
<div>1924&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // see if the latest compatible version is newer than the installed</div>
<div>1925&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // version</div>
<div>1926&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Package installed = getInstalledPackageInfo(p.getName());</div>
<div>1927&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            String installedV =</div>
<div>1928&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              installed.getPackageMetaDataElement(</div>
<div>1929&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                VersionPackageConstraint.VERSION_KEY).toString();</div>
<div>1930&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            String versionedV =</div>
<div>1931&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              versionedPackage.getPackageMetaDataElement(</div>
<div>1932&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                VersionPackageConstraint.VERSION_KEY).toString();</div>
<div>1933&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            VersionPackageConstraint.VersionComparison v =</div>
<div>1934&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              VersionPackageConstraint.compare(versionedV, installedV);</div>
<div>1935&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (v == VersionPackageConstraint.VersionComparison.GREATERTHAN) {</div>
<div>1936&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              compatible.add(versionedPackage);</div>
<div>1937&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>1938&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          } else {</div>
<div>1939&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            compatible.add(versionedPackage);</div>
<div>1940&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>1941&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          break;</div>
<div>1942&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>1943&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1944&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1945&emsp;&emsp;</div>
<div>1946&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return compatible;</div>
<div>1947&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1948&emsp;&emsp;</div>
<div>1949&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1950&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get the latest version of the named package that is compatible with the</div>
<div>1951&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * base version of Weka being used.</div>
<div>1952&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *</div>
<div>1953&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package to get the latest compatible version of</div>
<div>1954&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the latest compatible version or null if there is no compatible package</div>
<div>1955&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1956&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1957&emsp;&emsp;&nbsp;&nbsp;  public static Package getLatestCompatibleVersion(String packageName)</div>
<div>1958&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>1959&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package latest = null;</div>
<div>1960&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Object> availableVersions =</div>
<div>1961&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.getRepositoryPackageVersions(packageName);</div>
<div>1962&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    for (Object version : availableVersions) {</div>
<div>1963&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Package versionedPackage =</div>
<div>1964&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        getRepositoryPackageInfo(packageName, version.toString());</div>
<div>1965&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (versionedPackage.isCompatibleBaseSystem()) {</div>
<div>1966&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        latest = versionedPackage;</div>
<div>1967&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        break;</div>
<div>1968&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>1969&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>1970&emsp;&emsp;</div>
<div>1971&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return latest;</div>
<div>1972&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1973&emsp;&emsp;</div>
<div>1974&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1975&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get a list of installed packages</div>
<div>1976&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>1977&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a list of installed packages</div>
<div>1978&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1979&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1980&emsp;&emsp;&nbsp;&nbsp;  public static List&#60;Package> getInstalledPackages() throws Exception {</div>
<div>1981&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>1982&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getInstalledPackages();</div>
<div>1983&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1984&emsp;&emsp;</div>
<div>1985&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>1986&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get a list of dependencies for a given package</div>
<div>1987&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>1988&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param target the package to get the dependencies for</div>
<div>1989&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param conflicts will hold any conflicts</div>
<div>1990&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return a list of dependencies for the target package</div>
<div>1991&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>1992&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>1993&emsp;&emsp;&nbsp;&nbsp;  public static List&#60;Dependency> getAllDependenciesForPackage(Package target,</div>
<div>1994&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, List&#60;Dependency>> conflicts) throws Exception {</div>
<div>1995&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>1996&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getAllDependenciesForPackage(target, conflicts);</div>
<div>1997&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>1998&emsp;&emsp;</div>
<div>1999&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2000&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Extract meta data from a package archive</div>
<div>2001&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2002&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageArchivePath the path to the package archive</div>
<div>2003&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the meta data for the package</div>
<div>2004&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2005&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2006&emsp;&emsp;&nbsp;&nbsp;  public static Package getPackageArchiveInfo(String packageArchivePath)</div>
<div>2007&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>2008&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2009&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getPackageArchiveInfo(packageArchivePath);</div>
<div>2010&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2011&emsp;&emsp;</div>
<div>2012&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2013&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get meta data for an installed package</div>
<div>2014&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2015&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package</div>
<div>2016&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the meta data for the package</div>
<div>2017&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2018&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2019&emsp;&emsp;&nbsp;&nbsp;  public static Package getInstalledPackageInfo(String packageName)</div>
<div>2020&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>2021&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2022&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getInstalledPackageInfo(packageName);</div>
<div>2023&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2024&emsp;&emsp;</div>
<div>2025&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2026&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get meta data for the latest version of a package from the repository</div>
<div>2027&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2028&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package</div>
<div>2029&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the meta data for the package</div>
<div>2030&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2031&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2032&emsp;&emsp;&nbsp;&nbsp;  public static Package getRepositoryPackageInfo(String packageName)</div>
<div>2033&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>2034&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2035&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getRepositoryPackageInfo(packageName);</div>
<div>2036&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2037&emsp;&emsp;</div>
<div>2038&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2039&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Get meta data for a specific version of a package from the repository</div>
<div>2040&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2041&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package</div>
<div>2042&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param version the version to get meta data for</div>
<div>2043&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return the meta data for the package</div>
<div>2044&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2045&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2046&emsp;&emsp;&nbsp;&nbsp;  public static Package getRepositoryPackageInfo(String packageName,</div>
<div>2047&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String version) throws Exception {</div>
<div>2048&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2049&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return PACKAGE_MANAGER.getRepositoryPackageInfo(packageName, version);</div>
<div>2050&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2051&emsp;&emsp;</div>
<div>2052&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2053&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Install a named package by retrieving the location of the archive from the</div>
<div>2054&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * meta data stored in the repository</div>
<div>2055&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2056&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package to install</div>
<div>2057&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param version the version of the package to install</div>
<div>2058&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress for reporting progress</div>
<div>2059&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if the package was installed successfully</div>
<div>2060&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2061&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2062&emsp;&emsp;&nbsp;&nbsp;  public static boolean installPackageFromRepository(String packageName,</div>
<div>2063&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String version, PrintStream... progress) throws Exception {</div>
<div>2064&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2065&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package toLoad = getRepositoryPackageInfo(packageName);</div>
<div>2066&emsp;&emsp;</div>
<div>2067&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // check to see if a version is already installed. If so, we</div>
<div>2068&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // wont load the updated version into the classpath immediately in</div>
<div>2069&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // order to avoid conflicts, class not found exceptions etc. The</div>
<div>2070&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // user is told to restart Weka for the changes to come into affect</div>
<div>2071&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // anyway, so there is no point in loading the updated package now.</div>
<div>2072&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean isAnUpgrade = toLoad.isInstalled();</div>
<div>2073&emsp;&emsp;</div>
<div>2074&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Object specialInstallMessage =</div>
<div>2075&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      toLoad.getPackageMetaDataElement(MESSAGE_TO_DISPLAY_ON_INSTALLATION_KEY);</div>
<div>2076&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (specialInstallMessage != null</div>
<div>2077&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      && specialInstallMessage.toString().length() > 0) {</div>
<div>2078&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String siM = specialInstallMessage.toString();</div>
<div>2079&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>2080&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        siM = Environment.getSystemWide().substitute(siM);</div>
<div>2081&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (Exception ex) {</div>
<div>2082&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // quietly ignore</div>
<div>2083&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2084&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String message =</div>
<div>2085&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        "**** Special installation message ****\n" + siM</div>
<div>2086&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "\n**** Special installation message ****";</div>
<div>2087&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (PrintStream p : progress) {</div>
<div>2088&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        p.println(message);</div>
<div>2089&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2090&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2091&emsp;&emsp;</div>
<div>2092&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER</div>
<div>2093&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .installPackageFromRepository(packageName, version, progress);</div>
<div>2094&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File packageDir =</div>
<div>2095&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      new File(PACKAGE_MANAGER.getPackageHome().toString() + File.separator</div>
<div>2096&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + packageName);</div>
<div>2097&emsp;&emsp;</div>
<div>2098&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (loadCheck(getInstalledPackageInfo(packageName), packageDir, progress)) {</div>
<div>2099&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>2100&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        .addPackageToClassLoader(packageDir);</div>
<div>2101&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2102&emsp;&emsp;</div>
<div>2103&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, List&#60;String>> injectDependencies = new HashMap&#60;>();</div>
<div>2104&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    checkForInjectDependencies(toLoad, injectDependencies);</div>
<div>2105&emsp;&emsp;</div>
<div>2106&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // inject dependencies before triggering any class discovery</div>
<div>2107&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    injectPackageDependencies(injectDependencies);</div>
<div>2108&emsp;&emsp;</div>
<div>2109&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // check that all dependencies are available, there are no missing classes</div>
<div>2110&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // and files etc.</div>
<div>2111&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>2112&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .performIntegrityCheck();</div>
<div>2113&emsp;&emsp;</div>
<div>2114&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // If the classloader for the package is still in play then</div>
<div>2115&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // process all props files</div>
<div>2116&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>2117&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .getPackageClassLoader(packageName) != null) {</div>
<div>2118&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      processPackageDirectory(packageDir, false, null, false);</div>
<div>2119&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2120&emsp;&emsp;</div>
<div>2121&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return isAnUpgrade;</div>
<div>2122&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2123&emsp;&emsp;</div>
<div>2124&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2125&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Install a package from an archive (unofficial package install route)</div>
<div>2126&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2127&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageArchivePath the path to the package archive file to install</div>
<div>2128&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress for reporting progress</div>
<div>2129&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if the package was installed successfully</div>
<div>2130&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2131&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2132&emsp;&emsp;&nbsp;&nbsp;  public static String installPackageFromArchive(String packageArchivePath,</div>
<div>2133&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PrintStream... progress) throws Exception {</div>
<div>2134&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2135&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package toInstall =</div>
<div>2136&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.getPackageArchiveInfo(packageArchivePath);</div>
<div>2137&emsp;&emsp;</div>
<div>2138&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Object specialInstallMessage =</div>
<div>2139&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      toInstall</div>
<div>2140&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        .getPackageMetaDataElement(MESSAGE_TO_DISPLAY_ON_INSTALLATION_KEY);</div>
<div>2141&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (specialInstallMessage != null</div>
<div>2142&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      && specialInstallMessage.toString().length() > 0) {</div>
<div>2143&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String siM = specialInstallMessage.toString();</div>
<div>2144&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      try {</div>
<div>2145&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        siM = Environment.getSystemWide().substitute(siM);</div>
<div>2146&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } catch (Exception ex) {</div>
<div>2147&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // quietly ignore</div>
<div>2148&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2149&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String message =</div>
<div>2150&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        "**** Special installation message ****\n" + siM</div>
<div>2151&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "\n**** Special installation message ****";</div>
<div>2152&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (PrintStream p : progress) {</div>
<div>2153&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        p.println(message);</div>
<div>2154&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2155&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2156&emsp;&emsp;</div>
<div>2157&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.installPackageFromArchive(packageArchivePath, progress);</div>
<div>2158&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return initializeAndLoadUnofficialPackage(toInstall, progress);</div>
<div>2159&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2160&emsp;&emsp;</div>
<div>2161&emsp;&emsp;&nbsp;&nbsp;  private static String initializeAndLoadUnofficialPackage(Package toInstall,</div>
<div>2162&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PrintStream... progress) throws Exception {</div>
<div>2163&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    File packageDir =</div>
<div>2164&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      new File(PACKAGE_MANAGER.getPackageHome() + File.separator</div>
<div>2165&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + toInstall.getName());</div>
<div>2166&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package toLoad = getInstalledPackageInfo(toInstall.getName());</div>
<div>2167&emsp;&emsp;</div>
<div>2168&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // no load check here as those checks involve the central repository (and</div>
<div>2169&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // this is an unofficial package)</div>
<div>2170&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>2171&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .addPackageToClassLoader(packageDir);</div>
<div>2172&emsp;&emsp;</div>
<div>2173&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;String, List&#60;String>> injectDependencies = new HashMap&#60;>();</div>
<div>2174&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    checkForInjectDependencies(toLoad, injectDependencies);</div>
<div>2175&emsp;&emsp;</div>
<div>2176&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // inject dependencies before triggering any class discovery</div>
<div>2177&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    injectPackageDependencies(injectDependencies);</div>
<div>2178&emsp;&emsp;</div>
<div>2179&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // check that all dependencies are available, there are no missing classes</div>
<div>2180&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // and files etc.</div>
<div>2181&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>2182&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .performIntegrityCheck();</div>
<div>2183&emsp;&emsp;</div>
<div>2184&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // If the classloader for the package is still in play then</div>
<div>2185&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // process all props files</div>
<div>2186&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>2187&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .getPackageClassLoader(toInstall.getName()) != null) {</div>
<div>2188&emsp;&emsp;</div>
<div>2189&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      processPackageDirectory(packageDir, false, null, false);</div>
<div>2190&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2191&emsp;&emsp;</div>
<div>2192&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return toInstall.getName();</div>
<div>2193&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2194&emsp;&emsp;</div>
<div>2195&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2196&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Install a package from the supplied URL</div>
<div>2197&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2198&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageURL the URL to the package archive to install</div>
<div>2199&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress for reporting progress</div>
<div>2200&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @return true if the package was installed successfully</div>
<div>2201&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2202&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2203&emsp;&emsp;&nbsp;&nbsp;  public static String installPackageFromURL(URL packageURL,</div>
<div>2204&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PrintStream... progress) throws Exception {</div>
<div>2205&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2206&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String packageName =</div>
<div>2207&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PACKAGE_MANAGER.installPackageFromURL(packageURL, progress);</div>
<div>2208&emsp;&emsp;</div>
<div>2209&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package installed = PACKAGE_MANAGER.getInstalledPackageInfo(packageName);</div>
<div>2210&emsp;&emsp;</div>
<div>2211&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Object specialInstallMessage =</div>
<div>2212&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      installed</div>
<div>2213&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        .getPackageMetaDataElement(MESSAGE_TO_DISPLAY_ON_INSTALLATION_KEY);</div>
<div>2214&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (specialInstallMessage != null</div>
<div>2215&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      && specialInstallMessage.toString().length() > 0) {</div>
<div>2216&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String message =</div>
<div>2217&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        "**** Special installation message ****\n"</div>
<div>2218&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + specialInstallMessage.toString()</div>
<div>2219&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "\n**** Special installation message ****";</div>
<div>2220&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (PrintStream p : progress) {</div>
<div>2221&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        p.println(message);</div>
<div>2222&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2223&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2224&emsp;&emsp;</div>
<div>2225&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return initializeAndLoadUnofficialPackage(installed, progress);</div>
<div>2226&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2227&emsp;&emsp;</div>
<div>2228&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2229&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Uninstall a named package</div>
<div>2230&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2231&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package to remove</div>
<div>2232&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param updateKnowledgeFlow true if any Knowledge Flow beans provided by the</div>
<div>2233&emsp;&emsp;&nbsp;&nbsp;&nbsp;   *          package should be deregistered from the KnoweledgeFlow</div>
<div>2234&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param progress for reporting progress</div>
<div>2235&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2236&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2237&emsp;&emsp;&nbsp;&nbsp;  public static void uninstallPackage(String packageName,</div>
<div>2238&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean updateKnowledgeFlow, PrintStream... progress) throws Exception {</div>
<div>2239&emsp;&emsp;</div>
<div>2240&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // check to see if this is a KnowledgeFlow package (presence of Beans.props</div>
<div>2241&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // file)</div>
<div>2242&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (updateKnowledgeFlow) {</div>
<div>2243&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      File packageToDel =</div>
<div>2244&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new File(PACKAGE_MANAGER.getPackageHome().toString() + File.separator</div>
<div>2245&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + packageName);</div>
<div>2246&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (packageToDel.exists() && packageToDel.isDirectory()) {</div>
<div>2247&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        File[] contents = packageToDel.listFiles();</div>
<div>2248&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (contents != null) {</div>
<div>2249&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          for (File content : contents) {</div>
<div>2250&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (content.isFile() && content.getPath().endsWith("Beans.props")) {</div>
<div>2251&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              // KnowledgeFlow plugin -- remove this properties file from the</div>
<div>2252&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              // list</div>
<div>2253&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              // of</div>
<div>2254&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              // bean plugin props</div>
<div>2255&emsp;&emsp;</div>
<div>2256&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              KnowledgeFlowApp.removeFromPluginBeanProps(content);</div>
<div>2257&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              KnowledgeFlowApp.disposeSingleton();</div>
<div>2258&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              break;</div>
<div>2259&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>2260&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2261&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2262&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        WekaPackageClassLoaderManager.getWekaPackageClassLoaderManager()</div>
<div>2263&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .removeClassLoaderForPackage(packageName);</div>
<div>2264&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2265&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2266&emsp;&emsp;</div>
<div>2267&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PACKAGE_MANAGER.uninstallPackage(packageName, progress);</div>
<div>2268&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2269&emsp;&emsp;</div>
<div>2270&emsp;&emsp;&nbsp;&nbsp;  private static void printPackageInfo(Map&#60;?, ?> packageProps) {</div>
<div>2271&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Set&#60;?> keys = packageProps.keySet();</div>
<div>2272&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Iterator&#60;?> i = keys.iterator();</div>
<div>2273&emsp;&emsp;</div>
<div>2274&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    while (i.hasNext()) {</div>
<div>2275&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Object key = i.next();</div>
<div>2276&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Object value = packageProps.get(key);</div>
<div>2277&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.out.println(Utils.padLeft(key.toString(), 11) + ":\t"</div>
<div>2278&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + value.toString());</div>
<div>2279&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2280&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2281&emsp;&emsp;</div>
<div>2282&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2283&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Print meta data on a package</div>
<div>2284&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2285&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packagePath the path to the package to print meta data for</div>
<div>2286&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2287&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2288&emsp;&emsp;&nbsp;&nbsp;  protected static void printPackageArchiveInfo(String packagePath)</div>
<div>2289&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>2290&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;?, ?> packageProps =</div>
<div>2291&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      getPackageArchiveInfo(packagePath).getPackageMetaData();</div>
<div>2292&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    printPackageInfo(packageProps);</div>
<div>2293&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2294&emsp;&emsp;</div>
<div>2295&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2296&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Print meta data for an installed package</div>
<div>2297&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2298&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package to print meta data for</div>
<div>2299&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2300&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2301&emsp;&emsp;&nbsp;&nbsp;  protected static void printInstalledPackageInfo(String packageName)</div>
<div>2302&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    throws Exception {</div>
<div>2303&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;?, ?> packageProps =</div>
<div>2304&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      getInstalledPackageInfo(packageName).getPackageMetaData();</div>
<div>2305&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    printPackageInfo(packageProps);</div>
<div>2306&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2307&emsp;&emsp;</div>
<div>2308&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2309&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Print meta data for a package listed in the repository</div>
<div>2310&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2311&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param packageName the name of the package to print meta data for</div>
<div>2312&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param version the version of the package</div>
<div>2313&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @throws Exception if a problem occurs</div>
<div>2314&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2315&emsp;&emsp;&nbsp;&nbsp;  protected static void printRepositoryPackageInfo(String packageName,</div>
<div>2316&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String version) throws Exception {</div>
<div>2317&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Map&#60;?, ?> packageProps =</div>
<div>2318&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      getRepositoryPackageInfo(packageName, version).getPackageMetaData();</div>
<div>2319&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    printPackageInfo(packageProps);</div>
<div>2320&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2321&emsp;&emsp;</div>
<div>2322&emsp;&emsp;&nbsp;&nbsp;  private static String queryUser() {</div>
<div>2323&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    java.io.BufferedReader br =</div>
<div>2324&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      new java.io.BufferedReader(new java.io.InputStreamReader(System.in));</div>
<div>2325&emsp;&emsp;</div>
<div>2326&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String result = null;</div>
<div>2327&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>2328&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      result = br.readLine();</div>
<div>2329&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (java.io.IOException ex) {</div>
<div>2330&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // ignore</div>
<div>2331&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2332&emsp;&emsp;</div>
<div>2333&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    return result;</div>
<div>2334&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2335&emsp;&emsp;</div>
<div>2336&emsp;&emsp;&nbsp;&nbsp;  private static void removeInstalledPackage(String packageName, boolean force,</div>
<div>2337&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    PrintStream... progress) throws Exception {</div>
<div>2338&emsp;&emsp;</div>
<div>2339&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Package> compromised = new ArrayList&#60;Package>();</div>
<div>2340&emsp;&emsp;</div>
<div>2341&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // Now check to see which other installed packages depend on this one</div>
<div>2342&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Package> installedPackages = null;</div>
<div>2343&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (!force) {</div>
<div>2344&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      installedPackages = getInstalledPackages();</div>
<div>2345&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (Package p : installedPackages) {</div>
<div>2346&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Dependency> tempDeps = p.getDependencies();</div>
<div>2347&emsp;&emsp;</div>
<div>2348&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (Dependency d : tempDeps) {</div>
<div>2349&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (d.getTarget().getPackage().getName().equals(packageName)) {</div>
<div>2350&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // add this installed package to the list</div>
<div>2351&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            compromised.add(p);</div>
<div>2352&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            break;</div>
<div>2353&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2354&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2355&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2356&emsp;&emsp;</div>
<div>2357&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (compromised.size() > 0) {</div>
<div>2358&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.out.println("The following installed packages depend on "</div>
<div>2359&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + packageName + " :\n");</div>
<div>2360&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (Package p : compromised) {</div>
<div>2361&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.out.println("\t" + p.getName());</div>
<div>2362&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2363&emsp;&emsp;</div>
<div>2364&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.out.println("\nDo you wish to proceed [y/n]?");</div>
<div>2365&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String response = queryUser();</div>
<div>2366&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (response != null</div>
<div>2367&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          && (response.equalsIgnoreCase("n") || response.equalsIgnoreCase("no"))) {</div>
<div>2368&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return; // bail out here</div>
<div>2369&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2370&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2371&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2372&emsp;&emsp;</div>
<div>2373&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (force) {</div>
<div>2374&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.out.println("Forced uninstall.");</div>
<div>2375&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2376&emsp;&emsp;</div>
<div>2377&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    compromised = null;</div>
<div>2378&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    installedPackages = null;</div>
<div>2379&emsp;&emsp;</div>
<div>2380&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    uninstallPackage(packageName, false, progress);</div>
<div>2381&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2382&emsp;&emsp;</div>
<div>2383&emsp;&emsp;&nbsp;&nbsp;  private static void installPackageFromRepository(String packageName,</div>
<div>2384&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    String version, boolean force) throws Exception {</div>
<div>2385&emsp;&emsp;</div>
<div>2386&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (version.equals("Latest")) {</div>
<div>2387&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // if no version/latest has been specified by the user then</div>
<div>2388&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // look for the latest version of the package that is compatible</div>
<div>2389&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // with the installed version of Weka.</div>
<div>2390&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      version = "none";</div>
<div>2391&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;Object> availableVersions =</div>
<div>2392&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PACKAGE_MANAGER.getRepositoryPackageVersions(packageName);</div>
<div>2393&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // version numbers will be in descending sorted order from the</div>
<div>2394&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // repository. We want the most recent version that is compatible</div>
<div>2395&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // with the base weka install</div>
<div>2396&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (Object v : availableVersions) {</div>
<div>2397&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Package versionedPackage =</div>
<div>2398&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          getRepositoryPackageInfo(packageName, v.toString());</div>
<div>2399&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (versionedPackage.isCompatibleBaseSystem()) {</div>
<div>2400&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          version =</div>
<div>2401&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            versionedPackage.getPackageMetaDataElement(</div>
<div>2402&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              VersionPackageConstraint.VERSION_KEY).toString();</div>
<div>2403&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          break;</div>
<div>2404&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2405&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2406&emsp;&emsp;</div>
<div>2407&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (version.equals("none")) {</div>
<div>2408&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        throw new Exception("Was unable to find a version of '" + packageName</div>
<div>2409&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + "' that is compatible with Weka " + Version.VERSION);</div>
<div>2410&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2411&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2412&emsp;&emsp;</div>
<div>2413&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Package toInstall = null;</div>
<div>2414&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>2415&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      toInstall = getRepositoryPackageInfo(packageName, version);</div>
<div>2416&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>2417&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.err.println("[WekaPackageManager] Package " + packageName</div>
<div>2418&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + " at version " + version + " doesn't seem to exist!");</div>
<div>2419&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // System.exit(1);</div>
<div>2420&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return;</div>
<div>2421&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2422&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    // First check to see if this package is compatible with the base system</div>
<div>2423&emsp;&emsp;</div>
<div>2424&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (!force) {</div>
<div>2425&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // check to see if it's disabled</div>
<div>2426&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Object disabled = toInstall.getPackageMetaDataElement(DISABLE_KEY);</div>
<div>2427&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (disabled == null) {</div>
<div>2428&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        disabled = toInstall.getPackageMetaDataElement(DISABLED_KEY);</div>
<div>2429&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2430&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (disabled != null && disabled.toString().equalsIgnoreCase("true")) {</div>
<div>2431&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Can't install package " + packageName</div>
<div>2432&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + " because it " + "has been disabled at the repository.");</div>
<div>2433&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</div>
<div>2434&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2435&emsp;&emsp;</div>
<div>2436&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      boolean ok = toInstall.isCompatibleBaseSystem();</div>
<div>2437&emsp;&emsp;</div>
<div>2438&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (!ok) {</div>
<div>2439&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Dependency> baseSysDep = toInstall.getBaseSystemDependency();</div>
<div>2440&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        StringBuffer depList = new StringBuffer();</div>
<div>2441&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (Dependency bd : baseSysDep) {</div>
<div>2442&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          depList.append(bd.getTarget().toString() + " ");</div>
<div>2443&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2444&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Can't install package " + packageName</div>
<div>2445&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + " because it requires " + depList.toString());</div>
<div>2446&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</div>
<div>2447&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2448&emsp;&emsp;</div>
<div>2449&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (toInstall.isInstalled()) {</div>
<div>2450&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Package installedVersion = getInstalledPackageInfo(packageName);</div>
<div>2451&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (!toInstall.equals(installedVersion)) {</div>
<div>2452&emsp;&emsp;</div>
<div>2453&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.out.println("Package " + packageName + "[" + installedVersion</div>
<div>2454&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + "] is already installed. Replace with " + toInstall + " [y/n]?");</div>
<div>2455&emsp;&emsp;</div>
<div>2456&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String response = queryUser();</div>
<div>2457&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (response != null</div>
<div>2458&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            && (response.equalsIgnoreCase("n") || response</div>
<div>2459&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              .equalsIgnoreCase("no"))) {</div>
<div>2460&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return; // bail out here</div>
<div>2461&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2462&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</div>
<div>2463&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.out.println("Package " + packageName + "[" + installedVersion</div>
<div>2464&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + "] is already installed. Install again [y/n]?");</div>
<div>2465&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String response = queryUser();</div>
<div>2466&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (response != null</div>
<div>2467&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            && (response.equalsIgnoreCase("n") || response</div>
<div>2468&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              .equalsIgnoreCase("no"))) {</div>
<div>2469&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return; // bail out here</div>
<div>2470&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2471&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2472&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2473&emsp;&emsp;</div>
<div>2474&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // Now get a full list of dependencies for this package and</div>
<div>2475&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // check for any conflicts</div>
<div>2476&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Map&#60;String, List&#60;Dependency>> conflicts =</div>
<div>2477&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new HashMap&#60;String, List&#60;Dependency>>();</div>
<div>2478&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;Dependency> dependencies =</div>
<div>2479&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        getAllDependenciesForPackage(toInstall, conflicts);</div>
<div>2480&emsp;&emsp;</div>
<div>2481&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (conflicts.size() > 0) {</div>
<div>2482&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Package " + packageName</div>
<div>2483&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + " requires the following packages:\n");</div>
<div>2484&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Iterator&#60;Dependency> depI = dependencies.iterator();</div>
<div>2485&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        while (depI.hasNext()) {</div>
<div>2486&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Dependency d = depI.next();</div>
<div>2487&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.err.println("\t" + d);</div>
<div>2488&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2489&emsp;&emsp;</div>
<div>2490&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("\nThere are conflicting dependencies:\n");</div>
<div>2491&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Set&#60;String> pNames = conflicts.keySet();</div>
<div>2492&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Iterator&#60;String> pNameI = pNames.iterator();</div>
<div>2493&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        while (pNameI.hasNext()) {</div>
<div>2494&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String pName = pNameI.next();</div>
<div>2495&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.err.println("Conflicts for " + pName);</div>
<div>2496&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          List&#60;Dependency> confsForPackage = conflicts.get(pName);</div>
<div>2497&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Iterator&#60;Dependency> confs = confsForPackage.iterator();</div>
<div>2498&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          while (confs.hasNext()) {</div>
<div>2499&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Dependency problem = confs.next();</div>
<div>2500&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            System.err.println("\t" + problem);</div>
<div>2501&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2502&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2503&emsp;&emsp;</div>
<div>2504&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Unable to continue with installation.");</div>
<div>2505&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return; // bail out here.</div>
<div>2506&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2507&emsp;&emsp;</div>
<div>2508&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // Next check all dependencies against what is installed and</div>
<div>2509&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // inform the user about which installed packages will be altered. Also</div>
<div>2510&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // build the list of only those packages that need to be installed or</div>
<div>2511&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // upgraded (excluding those that are already installed and are OK).</div>
<div>2512&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;PackageConstraint> needsUpgrade = new ArrayList&#60;PackageConstraint>();</div>
<div>2513&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      List&#60;Package> finalListToInstall = new ArrayList&#60;Package>();</div>
<div>2514&emsp;&emsp;</div>
<div>2515&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Iterator&#60;Dependency> depI = dependencies.iterator();</div>
<div>2516&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      while (depI.hasNext()) {</div>
<div>2517&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Dependency toCheck = depI.next();</div>
<div>2518&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (toCheck.getTarget().getPackage().isInstalled()) {</div>
<div>2519&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String toCheckName =</div>
<div>2520&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            toCheck.getTarget().getPackage()</div>
<div>2521&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              .getPackageMetaDataElement("PackageName").toString();</div>
<div>2522&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Package installedVersion =</div>
<div>2523&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            PACKAGE_MANAGER.getInstalledPackageInfo(toCheckName);</div>
<div>2524&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (!toCheck.getTarget().checkConstraint(installedVersion)) {</div>
<div>2525&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            needsUpgrade.add(toCheck.getTarget());</div>
<div>2526&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Package mostRecent = toCheck.getTarget().getPackage();</div>
<div>2527&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (toCheck.getTarget() instanceof weka.core.packageManagement.VersionPackageConstraint) {</div>
<div>2528&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              mostRecent =</div>
<div>2529&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                WekaPackageManager</div>
<div>2530&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  .mostRecentVersionWithRespectToConstraint(toCheck.getTarget());</div>
<div>2531&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>2532&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            finalListToInstall.add(mostRecent);</div>
<div>2533&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2534&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</div>
<div>2535&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Package mostRecent = toCheck.getTarget().getPackage();</div>
<div>2536&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (toCheck.getTarget() instanceof weka.core.packageManagement.VersionPackageConstraint) {</div>
<div>2537&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            mostRecent =</div>
<div>2538&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              WekaPackageManager</div>
<div>2539&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                .mostRecentVersionWithRespectToConstraint(toCheck.getTarget());</div>
<div>2540&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2541&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          finalListToInstall.add(mostRecent);</div>
<div>2542&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2543&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2544&emsp;&emsp;</div>
<div>2545&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // now check for precludes - first add compile all installed packages and</div>
<div>2546&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // then potentially overwrite with what's in the finalListToInstall</div>
<div>2547&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (toInstall.getPackageMetaDataElement(PRECLUDES_KEY) != null) {</div>
<div>2548&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Package> installed = getInstalledPackages();</div>
<div>2549&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Map&#60;String, Package> packageMap = new HashMap&#60;>();</div>
<div>2550&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (Package p : installed) {</div>
<div>2551&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          packageMap.put(p.getName(), p);</div>
<div>2552&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2553&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (Package p : finalListToInstall) {</div>
<div>2554&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          packageMap.put(p.getName(), p);</div>
<div>2555&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2556&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Package> precluded =</div>
<div>2557&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          toInstall.getPrecludedPackages(new ArrayList&#60;Package>(packageMap</div>
<div>2558&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            .values()));</div>
<div>2559&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (precluded.size() > 0) {</div>
<div>2560&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          List&#60;Package> finalPrecluded = new ArrayList&#60;>();</div>
<div>2561&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Set&#60;String> doNotLoadList = getDoNotLoadList();</div>
<div>2562&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          for (Package p : precluded) {</div>
<div>2563&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (!doNotLoadList.contains(p.getName())) {</div>
<div>2564&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              finalPrecluded.add(p);</div>
<div>2565&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>2566&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2567&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (finalPrecluded.size() > 0) {</div>
<div>2568&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            System.out.println("\nPackage " + toInstall.getName()</div>
<div>2569&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + " cannot be "</div>
<div>2570&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              + "installed because it precludes the following packages:\n");</div>
<div>2571&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            for (Package p : finalPrecluded) {</div>
<div>2572&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              System.out.println("\n\t" + p.toString());</div>
<div>2573&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>2574&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            System.out</div>
<div>2575&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              .println("Either uninstall or disable these packages before "</div>
<div>2576&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + "continuing.");</div>
<div>2577&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return; // bail out here</div>
<div>2578&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2579&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2580&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2581&emsp;&emsp;</div>
<div>2582&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (needsUpgrade.size() > 0) {</div>
<div>2583&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.out</div>
<div>2584&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .println("The following packages will be upgraded in order to install "</div>
<div>2585&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            + packageName);</div>
<div>2586&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Iterator&#60;PackageConstraint> upI = needsUpgrade.iterator();</div>
<div>2587&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        while (upI.hasNext()) {</div>
<div>2588&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          PackageConstraint tempC = upI.next();</div>
<div>2589&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.out.println("\t" + tempC);</div>
<div>2590&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2591&emsp;&emsp;</div>
<div>2592&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.out.print("\nOK to continue [y/n]? > ");</div>
<div>2593&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String response = queryUser();</div>
<div>2594&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (response != null</div>
<div>2595&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          && (response.equalsIgnoreCase("n") || response.equalsIgnoreCase("no"))) {</div>
<div>2596&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return; // bail out here</div>
<div>2597&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2598&emsp;&emsp;</div>
<div>2599&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // now take a look at the other installed packages and see if</div>
<div>2600&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // any would have a problem when these ones are upgraded</div>
<div>2601&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        boolean conflictsAfterUpgrade = false;</div>
<div>2602&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Package> installed = getInstalledPackages();</div>
<div>2603&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;Package> toUpgrade = new ArrayList&#60;Package>();</div>
<div>2604&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        upI = needsUpgrade.iterator();</div>
<div>2605&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        while (upI.hasNext()) {</div>
<div>2606&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          toUpgrade.add(upI.next().getPackage());</div>
<div>2607&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2608&emsp;&emsp;</div>
<div>2609&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // add the actual package the user is wanting to install if it</div>
<div>2610&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // is going to be an up/downgrade rather than a first install since</div>
<div>2611&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // other installed packages may depend on the currently installed</div>
<div>2612&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // version</div>
<div>2613&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // and thus could be affected after the up/downgrade</div>
<div>2614&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        toUpgrade.add(toInstall);</div>
<div>2615&emsp;&emsp;</div>
<div>2616&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (int i = 0; i &#60; installed.size(); i++) {</div>
<div>2617&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          Package tempP = installed.get(i);</div>
<div>2618&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String tempPName = tempP.getName();</div>
<div>2619&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          boolean checkIt = true;</div>
<div>2620&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          for (int j = 0; j &#60; needsUpgrade.size(); j++) {</div>
<div>2621&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (tempPName.equals(needsUpgrade.get(j).getPackage().getName())) {</div>
<div>2622&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              checkIt = false;</div>
<div>2623&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              break;</div>
<div>2624&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>2625&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2626&emsp;&emsp;</div>
<div>2627&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (checkIt) {</div>
<div>2628&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            List&#60;Dependency> problem =</div>
<div>2629&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              tempP.getIncompatibleDependencies(toUpgrade);</div>
<div>2630&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (problem.size() > 0) {</div>
<div>2631&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              conflictsAfterUpgrade = true;</div>
<div>2632&emsp;&emsp;</div>
<div>2633&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              System.err.println("Package " + tempP.getName()</div>
<div>2634&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + " will have a compatibility"</div>
<div>2635&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + "problem with the following packages after upgrading them:");</div>
<div>2636&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              Iterator&#60;Dependency> dI = problem.iterator();</div>
<div>2637&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              while (dI.hasNext()) {</div>
<div>2638&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                System.err.println("\t" + dI.next().getTarget().getPackage());</div>
<div>2639&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              }</div>
<div>2640&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</div>
<div>2641&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2642&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2643&emsp;&emsp;</div>
<div>2644&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (conflictsAfterUpgrade) {</div>
<div>2645&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.err.println("Unable to continue with installation.");</div>
<div>2646&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return; // bail out here</div>
<div>2647&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2648&emsp;&emsp;</div>
<div>2649&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2650&emsp;&emsp;</div>
<div>2651&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (finalListToInstall.size() > 0) {</div>
<div>2652&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.out.println("To install " + packageName</div>
<div>2653&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          + " the following packages will" + " be installed/upgraded:\n\n");</div>
<div>2654&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Iterator&#60;Package> i = finalListToInstall.iterator();</div>
<div>2655&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        while (i.hasNext()) {</div>
<div>2656&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.out.println("\t" + i.next());</div>
<div>2657&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2658&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.out.print("\nOK to proceed [y/n]? > ");</div>
<div>2659&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String response = queryUser();</div>
<div>2660&emsp;&emsp;</div>
<div>2661&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (response != null</div>
<div>2662&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          && (response.equalsIgnoreCase("n") || response.equalsIgnoreCase("no"))) {</div>
<div>2663&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return; // bail out here</div>
<div>2664&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2665&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2666&emsp;&emsp;</div>
<div>2667&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // OK, now we can download and install everything</div>
<div>2668&emsp;&emsp;</div>
<div>2669&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // First install the final list of dependencies</div>
<div>2670&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      installPackages(finalListToInstall, System.out);</div>
<div>2671&emsp;&emsp;</div>
<div>2672&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // Now install the package itself</div>
<div>2673&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      installPackageFromRepository(packageName, version, System.out);</div>
<div>2674&emsp;&emsp;</div>
<div>2675&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } else {</div>
<div>2676&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // just install this package without checking/downloading dependencies</div>
<div>2677&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // etc.</div>
<div>2678&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      installPackageFromRepository(packageName, version, System.out);</div>
<div>2679&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2680&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2681&emsp;&emsp;</div>
<div>2682&emsp;&emsp;&nbsp;&nbsp;  private static void listPackages(String arg) throws Exception {</div>
<div>2683&emsp;&emsp;</div>
<div>2684&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (m_offline</div>
<div>2685&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      && (arg.equalsIgnoreCase("all") || arg.equalsIgnoreCase("available"))) {</div>
<div>2686&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.out.println("Running offline - unable to display "</div>
<div>2687&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "available or all package information");</div>
<div>2688&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return;</div>
<div>2689&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2690&emsp;&emsp;</div>
<div>2691&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    List&#60;Package> packageList = null;</div>
<div>2692&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    useCacheOrOnlineRepository();</div>
<div>2693&emsp;&emsp;</div>
<div>2694&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (arg.equalsIgnoreCase("all")) {</div>
<div>2695&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      packageList = PACKAGE_MANAGER.getAllPackages();</div>
<div>2696&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } else if (arg.equals("installed")) {</div>
<div>2697&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      packageList = PACKAGE_MANAGER.getInstalledPackages();</div>
<div>2698&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } else if (arg.equals("available")) {</div>
<div>2699&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      packageList = PACKAGE_MANAGER.getAvailablePackages();</div>
<div>2700&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } else {</div>
<div>2701&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.err.println("[WekaPackageManager] Unknown argument " + arg);</div>
<div>2702&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      printUsage();</div>
<div>2703&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // System.exit(1);</div>
<div>2704&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      return;</div>
<div>2705&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2706&emsp;&emsp;</div>
<div>2707&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    StringBuffer result = new StringBuffer();</div>
<div>2708&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    result.append("Installed\tRepository\tLoaded\tPackage\n");</div>
<div>2709&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    result.append("=========\t==========\t======\t=======\n");</div>
<div>2710&emsp;&emsp;</div>
<div>2711&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    boolean userOptedNoLoad = false;</div>
<div>2712&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    Iterator&#60;Package> i = packageList.iterator();</div>
<div>2713&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    while (i.hasNext()) {</div>
<div>2714&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Package p = i.next();</div>
<div>2715&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String installedV = "-----    ";</div>
<div>2716&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String repositoryV = "-----     ";</div>
<div>2717&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String loaded = "No";</div>
<div>2718&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (p.isInstalled()) {</div>
<div>2719&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Package installedP = getInstalledPackageInfo(p.getName());</div>
<div>2720&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (loadCheck(installedP, new File(WekaPackageManager.getPackageHome()</div>
<div>2721&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          .toString() + File.separator + p.getName()))) {</div>
<div>2722&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          loaded = "Yes";</div>
<div>2723&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</div>
<div>2724&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (m_doNotLoadList.contains(installedP.getName())) {</div>
<div>2725&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            loaded = "No*";</div>
<div>2726&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            userOptedNoLoad = true;</div>
<div>2727&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2728&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2729&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        installedV =</div>
<div>2730&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          installedP.getPackageMetaDataElement(VERSION_KEY).toString() + "    ";</div>
<div>2731&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        try {</div>
<div>2732&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (!m_offline) {</div>
<div>2733&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Package repP = getRepositoryPackageInfo(p.getName());</div>
<div>2734&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            repositoryV =</div>
<div>2735&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              repP.getPackageMetaDataElement(VERSION_KEY).toString() + "     ";</div>
<div>2736&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2737&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } catch (Exception ex) {</div>
<div>2738&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // not at the repository</div>
<div>2739&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2740&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>2741&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        repositoryV =</div>
<div>2742&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          p.getPackageMetaDataElement(VERSION_KEY).toString() + "     ";</div>
<div>2743&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2744&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      String title = p.getPackageMetaDataElement("Title").toString();</div>
<div>2745&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      result.append(installedV + "\t" + repositoryV + "\t" + loaded + "\t"</div>
<div>2746&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + p.getName() + ": " + title + "\n");</div>
<div>2747&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2748&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (userOptedNoLoad) {</div>
<div>2749&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      result.append("* User flagged as no load\n");</div>
<div>2750&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2751&emsp;&emsp;</div>
<div>2752&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    System.out.println(result.toString());</div>
<div>2753&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2754&emsp;&emsp;</div>
<div>2755&emsp;&emsp;&nbsp;&nbsp;  private static void printUsage() {</div>
<div>2756&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    System.out</div>
<div>2757&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .println("Usage: weka.core.WekaPackageManager [-offline] [option]");</div>
<div>2758&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    System.out</div>
<div>2759&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      .println("Options:\n"</div>
<div>2760&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "\t-list-packages &#60;all | installed | available>\n"</div>
<div>2761&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "\t-package-info &#60;repository | installed | archive> "</div>
<div>2762&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "&#60;packageName | packageZip>\n\t-install-package &#60;packageName | packageZip | URL> [version]\n"</div>
<div>2763&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "\t-uninstall-package packageName\n"</div>
<div>2764&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "\t-toggle-load-status packageName [packageName packageName ...]\n"</div>
<div>2765&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + "\t-refresh-cache");</div>
<div>2766&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2767&emsp;&emsp;</div>
<div>2768&emsp;&emsp;&nbsp;&nbsp;  /**</div>
<div>2769&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * Main method for using the package manager from the command line</div>
<div>2770&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * </div>
<div>2771&emsp;&emsp;&nbsp;&nbsp;&nbsp;   * @param args command line arguments</div>
<div>2772&emsp;&emsp;&nbsp;&nbsp;&nbsp;   */</div>
<div>2773&emsp;&emsp;&nbsp;&nbsp;  public static void main(String[] args) {</div>
<div>2774&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    weka.core.logging.Logger.log(weka.core.logging.Logger.Level.INFO,</div>
<div>2775&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      "Logging started");</div>
<div>2776&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    try {</div>
<div>2777&emsp;&emsp;</div>
<div>2778&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // scan for -offline</div>
<div>2779&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for (int i = 0; i &#60; args.length; i++) {</div>
<div>2780&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (args[i].equals("-offline")) {</div>
<div>2781&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          m_offline = true;</div>
<div>2782&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String[] temp = new String[args.length - 1];</div>
<div>2783&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (i > 0) {</div>
<div>2784&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            System.arraycopy(args, 0, temp, 0, i);</div>
<div>2785&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2786&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.arraycopy(args, i + 1, temp, i, args.length - (i + 1));</div>
<div>2787&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          args = temp;</div>
<div>2788&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2789&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2790&emsp;&emsp;</div>
<div>2791&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      establishCacheIfNeeded(System.out);</div>
<div>2792&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      checkForNewPackages(System.out);</div>
<div>2793&emsp;&emsp;</div>
<div>2794&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (args.length == 0 || args[0].equalsIgnoreCase("-h")</div>
<div>2795&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        || args[0].equalsIgnoreCase("-help")) {</div>
<div>2796&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        printUsage();</div>
<div>2797&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // System.exit(1);</div>
<div>2798&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</div>
<div>2799&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2800&emsp;&emsp;</div>
<div>2801&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if (args[0].equals("-package-info")) {</div>
<div>2802&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (args.length &#60; 3) {</div>
<div>2803&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          printUsage();</div>
<div>2804&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return;</div>
<div>2805&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // System.exit(1);</div>
<div>2806&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2807&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (args[1].equals("archive")) {</div>
<div>2808&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          printPackageArchiveInfo(args[2]);</div>
<div>2809&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else if (args[1].equals("installed")) {</div>
<div>2810&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          printInstalledPackageInfo(args[2]);</div>
<div>2811&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else if (args[1].equals("repository")) {</div>
<div>2812&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String version = "Latest";</div>
<div>2813&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (args.length == 4) {</div>
<div>2814&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            version = args[3];</div>
<div>2815&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2816&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          try {</div>
<div>2817&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            printRepositoryPackageInfo(args[2], version);</div>
<div>2818&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          } catch (Exception ex) {</div>
<div>2819&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // problem with getting info on package from repository?</div>
<div>2820&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            // Must not be an "official" repository package</div>
<div>2821&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            System.out</div>
<div>2822&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              .println("[WekaPackageManager] Nothing known about package "</div>
<div>2823&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                + args[2] + " at the repository!");</div>
<div>2824&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2825&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</div>
<div>2826&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          System.err</div>
<div>2827&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            .println("[WekaPackageManager] Unknown argument " + args[2]);</div>
<div>2828&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          printUsage();</div>
<div>2829&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return;</div>
<div>2830&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // System.exit(1);</div>
<div>2831&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2832&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else if (args[0].equals("-install-package")) {</div>
<div>2833&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String targetLowerCase = args[1].toLowerCase();</div>
<div>2834&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (targetLowerCase.startsWith("http://")</div>
<div>2835&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          || targetLowerCase.startsWith("https://")) {</div>
<div>2836&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          URL packageURL = new URL(args[1]);</div>
<div>2837&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          installPackageFromURL(packageURL, System.out);</div>
<div>2838&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else if (targetLowerCase.endsWith(".zip")) {</div>
<div>2839&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          installPackageFromArchive(args[1], System.out);</div>
<div>2840&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</div>
<div>2841&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // assume a named package at the central repository</div>
<div>2842&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          String version = "Latest";</div>
<div>2843&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (args.length == 3) {</div>
<div>2844&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            version = args[2];</div>
<div>2845&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2846&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          installPackageFromRepository(args[1], version, false);</div>
<div>2847&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2848&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else if (args[0].equals("-uninstall-package")) {</div>
<div>2849&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (args.length &#60; 2) {</div>
<div>2850&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          printUsage();</div>
<div>2851&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return;</div>
<div>2852&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // System.exit(1);</div>
<div>2853&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2854&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        boolean force = false;</div>
<div>2855&emsp;&emsp;</div>
<div>2856&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (args.length == 3) {</div>
<div>2857&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          if (args[2].equals("-force")) {</div>
<div>2858&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            force = true;</div>
<div>2859&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }</div>
<div>2860&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2861&emsp;&emsp;</div>
<div>2862&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        removeInstalledPackage(args[1], force, System.out);</div>
<div>2863&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        // System.exit(0);</div>
<div>2864&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</div>
<div>2865&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else if (args[0].equals("-list-packages")) {</div>
<div>2866&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (args.length &#60; 2) {</div>
<div>2867&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          printUsage();</div>
<div>2868&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          // System.exit(1);</div>
<div>2869&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return;</div>
<div>2870&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2871&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        listPackages(args[1]);</div>
<div>2872&emsp;&emsp;</div>
<div>2873&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else if (args[0].equals("-toggle-load-status")) {</div>
<div>2874&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (args.length == 1) {</div>
<div>2875&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          printUsage();</div>
<div>2876&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          return;</div>
<div>2877&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2878&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        List&#60;String> toToggle = new ArrayList&#60;String>();</div>
<div>2879&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (int i = 1; i &#60; args.length; i++) {</div>
<div>2880&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          toToggle.add(args[i].trim());</div>
<div>2881&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2882&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (toToggle.size() >= 1) {</div>
<div>2883&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          toggleLoadStatus(toToggle);</div>
<div>2884&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</div>
<div>2885&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else if (args[0].equals("-refresh-cache")) {</div>
<div>2886&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        refreshCache(System.out);</div>
<div>2887&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } else {</div>
<div>2888&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        System.err.println("Unknown option: " + args[0]);</div>
<div>2889&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        printUsage();</div>
<div>2890&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }</div>
<div>2891&emsp;&emsp;</div>
<div>2892&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      System.exit(0);</div>
<div>2893&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    } catch (Exception ex) {</div>
<div>2894&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ex.printStackTrace();</div>
<div>2895&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;    }</div>
<div>2896&emsp;&emsp;&nbsp;&nbsp;  }</div>
<div>2897&emsp;&emsp;}</div>
</div>
</div>
</body>
</html>